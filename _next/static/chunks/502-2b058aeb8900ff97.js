"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[502],{1502:function(e,t,n){n.d(t,{Z:function(){return Rn}});var i=n(7294),a=n(1163),s=n(5152),r=n.n(s),l=n(5616),o=n(7720),c=n(1458),d=n(44),h=n(5861),m=n(6886),u=n(9200),x=n(7998),g=n(6242),j=n(4267),p=n(8462),b=n(891),y=n(8885),f=n(9334),Z=n(5662),v=n(3619),w=n(5670),S=n(5511),k=n(5023),C=n(375),P=n(7446),A=n(3920),$=n(8445),L=n(5739),I=n(9496),F=n(7109),M=n(3946),E=n(4054),q=n(3841),W=n(7058),B=n(1292),D=n(6664),T=n(6824),G=n(622),H=n(4510),z=n(6066);function R(){const{data:e}=(0,z.UEB)({fetchPolicy:"cache-only"});return e?.me?.account?.hero??void 0}var N=n(1789),K=n(1683),Q=n(8972),_=n(1903),J=n(5893);function Y({hero:e,to:t}){const[n,{loading:a}]=(0,z.F2d)(),[s,{loading:r}]=(0,z.AFf)(),{data:c,refetch:d}=(0,z._vS)({pollInterval:5e3}),[u,x]=(0,i.useState)(0),[g,j]=(0,i.useState)(""),[p,{loading:b}]=(0,z.Fwk)(),y=b||a;if(!c?.me?.account?.hero)return null;const{incomingTrades:f,outgoingTrades:v}=c.me.account.hero,w="Select an item to offer",S=e.inventory.filter((e=>e.type!==z.$7w.Quest)).sort(N.v4);async function k(e){try{await n({variables:{offer:e}})}catch(t){}}const C=S.find((e=>e.id===g));return(0,J.jsxs)(l.Z,{sx:{p:2,m:1,bgcolor:"background.paper"},children:[(0,J.jsx)(h.Z,{color:"error",variant:"h4",children:"Offer trade"}),(0,J.jsx)(h.Z,{children:"You can offer one of your items for gold, and then the other player must accept."}),(0,J.jsxs)(m.ZP,{sx:{mt:1},container:!0,columns:6,spacing:3,children:[(0,J.jsx)(m.ZP,{item:!0,xs:6,sm:3,children:(0,J.jsxs)(E.Z,{fullWidth:!0,children:[(0,J.jsx)(q.Z,{id:"trade-item-select-label",children:w}),(0,J.jsx)(K.Z,{id:"trade-item-select",labelId:"trade-item-select-label",label:w,value:g,onChange:e=>j(e.target.value),children:S.map((t=>(0,J.jsx)(Q.Z,{value:t.id,disabled:(0,N.mQ)(e,t),children:(0,N.GJ)(t)},t.id)))})]})}),(0,J.jsx)(m.ZP,{item:!0,xs:6,sm:3,children:(0,J.jsx)(_.Z,{label:"Gold value",value:0===u?"":u,onChange:function(e){let t=Number(e.target.value);!isNaN(t)&&Number.isFinite(t)&&(t=Math.round(Math.max(0,Math.min(2e9,t))),console.log(t),x(t))}})}),(0,J.jsx)(m.ZP,{item:!0,xs:6,children:(0,J.jsxs)(Z.Z,{variant:"contained",fullWidth:!0,disabled:u<=0||!g.length||y,onClick:async function(){try{const e=g;await p({variables:{offer:{to:t,item:e,gold:u}}});d()}catch(e){}},children:[C&&`Offer ${(0,N.GJ)(C)} for ${u.toLocaleString()} gold`,!C&&"Select an item to offer"]})}),(0,J.jsx)(m.ZP,{item:!0,xs:6,children:(0,J.jsx)(o.Z,{})}),f.length>0&&(0,J.jsxs)(m.ZP,{item:!0,xs:6,children:["Received offers:",(0,J.jsx)(l.Z,{children:f.map((t=>(0,J.jsx)(i.Fragment,{children:(0,J.jsxs)(l.Z,{sx:{mt:1,bgcolor:"info.main",p:2},children:["From: ",(0,J.jsx)("b",{children:t.fromName}),(0,J.jsx)("br",{}),"Item: ",(0,J.jsx)("b",{children:(0,N.GJ)(t.item)}),(0,J.jsx)("br",{}),"Gold: ",(0,J.jsx)("b",{children:t.gold.toLocaleString()}),(0,J.jsx)("br",{}),(0,J.jsx)(Z.Z,{sx:{m:1},variant:"contained",color:"success",disabled:y||t.gold>e.gold,onClick:()=>async function(e){try{await s({variables:{offer:e}})}catch(t){}}(t.id),children:"Accept Trade"}),(0,J.jsx)(Z.Z,{sx:{m:1},variant:"contained",color:"error",disabled:y,onClick:()=>k(t.id),children:"Reject Trade"})]})},t.id)))})]}),v.length>0&&(0,J.jsxs)(m.ZP,{item:!0,xs:6,children:["Sent offers:",(0,J.jsx)(l.Z,{children:v.map((e=>(0,J.jsx)(i.Fragment,{children:(0,J.jsxs)(l.Z,{sx:{mt:1,bgcolor:"info.main",p:2},children:["To: ",(0,J.jsx)("b",{children:e.toName}),(0,J.jsx)("br",{}),"Item: ",(0,J.jsx)("b",{children:(0,N.GJ)(e.item)}),(0,J.jsx)("br",{}),"Gold: ",(0,J.jsx)("b",{children:e.gold.toLocaleString()}),(0,J.jsx)("br",{}),(0,J.jsx)("br",{}),(0,J.jsx)(Z.Z,{variant:"contained",color:"error",disabled:y,onClick:()=>k(e.id),children:"Cancel Trade"})]})},e.id)))})]})]})]})}var O=n(629);function U({artifact:e,title:t,affixes:n,sx:a,children:s}){if(!e||!t)return null;const r=(0,N.Vy)(e);let l=(e,t)=>(0,J.jsx)(h.Z,{variant:"body1",sx:a,children:(0,J.jsx)("b",{children:e})},t);return"function"===typeof s&&(l=s),(0,J.jsxs)(i.Fragment,{children:[(0,J.jsx)(h.Z,{children:t}),r.map((e=>n&&!n.includes(e.type)?null:l((0,N.xq)(e),e.type)))]})}function V({artifact:e,isSelected:t,title:n,onSelect:a,disabled:s=!1}){return(0,J.jsxs)(O.Z,{sx:{flex:1,p:2,cursor:s?"not-allowed":"pointer",transition:"all 0.2s",border:"2px solid",borderColor:t?"primary.main":"divider",bgcolor:t?"action.selected":"background.paper",opacity:s?.5:1,"&:hover":{bgcolor:s?"background.paper":"action.hover"}},elevation:t?8:1,onClick:s?void 0:a,children:[(0,J.jsx)(h.Z,{variant:"h6",gutterBottom:!0,"data-testid":`${n.toLowerCase().replace(/\s+/g,"-")}-title`,children:n}),e?(0,J.jsxs)(i.Fragment,{children:[(0,J.jsx)(h.Z,{variant:"subtitle1",children:e.name}),(0,J.jsx)(U,{artifact:e,title:`${n} Stats`})]}):(0,J.jsx)(h.Z,{color:"text.secondary",children:"No artifact equipped"})]})}var X=n(657),ee=n(7645),te=n(6580),ne=n(1425);function ie({open:e,title:t,message:n,warningMessage:i,onConfirm:a,onCancel:s}){return(0,J.jsxs)(X.Z,{open:e,onClose:s,"aria-labelledby":"confirmation-dialog-title",children:[(0,J.jsx)(ee.Z,{id:"confirmation-dialog-title",children:t}),(0,J.jsxs)(te.Z,{children:[(0,J.jsx)(h.Z,{children:n}),i&&(0,J.jsx)(h.Z,{color:"error",sx:{mt:2},children:i})]}),(0,J.jsxs)(ne.Z,{children:[(0,J.jsx)(Z.Z,{onClick:s,color:"inherit","data-testid":"cancel-button",children:"Cancel"}),(0,J.jsx)(Z.Z,{onClick:a,color:"primary",variant:"contained",autoFocus:!0,"data-testid":"confirm-button",children:"Confirm"})]})]})}function ae({currentArtifact:e,newArtifact:t}){const[n,a]=(0,i.useState)(!1),[s,r]=(0,i.useState)(e?null:"new"),[o]=(0,z.jDZ)(),[c]=(0,z.MAF)();return(0,J.jsxs)(i.Fragment,{children:[(0,J.jsxs)(l.Z,{sx:{textAlign:"center",mb:4},children:[(0,J.jsx)(h.Z,{variant:"h4",gutterBottom:!0,children:"Choose Your Artifact"}),(0,J.jsx)(h.Z,{variant:"body1",color:"text.secondary",gutterBottom:!0,children:e?"Select which artifact you want to keep. This choice cannot be undone.":"You have no artifact equipped. The new artifact will be automatically equipped."})]}),(0,J.jsxs)(l.Z,{sx:{display:"flex",gap:4,mb:4},children:[(0,J.jsx)(V,{artifact:e,isSelected:"current"===s,title:"Current Artifact",onSelect:()=>e&&r("current"),disabled:!e}),(0,J.jsx)(V,{artifact:t,isSelected:"new"===s,title:"New Artifact",onSelect:()=>r("new")})]}),(0,J.jsx)(l.Z,{sx:{display:"flex",justifyContent:"center"},children:(0,J.jsx)(Z.Z,{variant:"contained",color:"primary",disabled:!s,onClick:()=>a(!0),sx:{minWidth:200},children:e?"Continue with Selected":"Accept New Artifact"})}),(0,J.jsx)(ie,{open:n,title:"Confirm Your Choice",message:e?`Are you sure you want to keep the ${"new"===s?"new":"current"} artifact?`:"Are you sure you want to equip the new artifact?",warningMessage:e?"This action cannot be undone.":void 0,onConfirm:async()=>{"new"===s?await o():await c()},onCancel:()=>a(!1)})]})}var se=n(1042);function re(){const{enqueueSnackbar:e}=(0,I.Ds)(),t=R(),{data:n}=(0,z.UEB)(),{data:a}=(0,z.TXn)(),[s,r]=(0,i.useState)(!1),[o,c]=(0,i.useState)([]),[m,u]=(0,i.useState)(!1),[x,g]=(0,i.useState)(""),[j,p]=(0,i.useState)("all"),[b,y]=(0,i.useState)({all:{type:"built-in"},chat:{type:"built-in"},notifications:{type:"built-in"}}),f=(0,i.useRef)();function v(e){return e.trim()}(0,i.useEffect)((()=>{o.length>200&&c(o.slice(0,200))}),[o.length]),(0,i.useEffect)((()=>{if(f.current)return;if(!a?.chat?.token)return;const t={drop:"error",artifact:"warning",quest:"success",settlement:"info"},n=se.qZ||window.location.origin;return f.current=(0,A.io)(n,{withCredentials:!0,path:se.Mb||"/socket.io",auth:{token:a.chat.token}}),f.current.on("hello",(e=>{c(e.chat)})),f.current.on("chat",(e=>{console.log("Got chat event!",e),c((t=>[e,...t]))})),f.current.on("notification",(n=>{if(n.item&&(n.message=n.message.replace("{{item}}",(0,N.GJ)(n.item))),"drop"===n.type)n.item?e(`You found ${(0,N.GJ)(n.item)}`,{variant:"success"}):e(n.message,{variant:"success"});else if("artifact"===n.type){const t=function(e,t){return e.includes("rejected")?{message:"Kept existing artifact",variant:"info"}:t?{message:`Equipped ${t.name}`,variant:"success"}:{message:e,variant:"success"}}(n.message,n.artifactItem);e(t.message,{variant:t.variant})}else"settlement"!==n.type&&e(n.message,{variant:"info"});c((e=>[{type:n.type??"notification",id:Math.random(),time:Date.now()/1e3,message:"",from:n.message,color:t[n.type]??"secondary",variant:"body1"},...e]))})),f.current.on("system-message",(t=>{e(t.message,{variant:"warning"}),c((e=>[{type:"system",id:Math.random(),time:Date.now()/1e3,message:t.message,from:"",color:t.color,variant:"h6"},...e]))})),()=>{f.current&&(f.current.disconnect(),f.current=void 0)}}),[a?.chat?.token]);const k=v(x);async function P(){if(!f.current?.connected)return;if(!k)return;const e=b[j];"private"===e.type?f.current.emit("private",{to:e.heroId,message:k}):f.current.emit("chat",{message:k}),g("")}const K=o.filter((e=>{if("all"===j)return!0;if("chat"===j)return"chat"===e.type||"private"===e.type||"system"===e.type;if("notifications"===j)return"notification"===e.type||"drop"===e.type||"quest"===e.type||"system"===e.type;const t=b[j];return!t||"private"===t.type&&("private"===e.type&&(e.heroId===t.heroId||e.to===t.heroId))})),Q=m?`Max message: ${140-k.length}/140`:"Type here...",_=n?.me?.account?.hero?.pendingArtifact;return(0,J.jsxs)(i.Fragment,{children:[(0,J.jsx)(D.Z,{open:!t?.currentQuest&&!!_,onClose:()=>{},children:(0,J.jsx)(l.Z,{sx:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",bgcolor:"background.paper",padding:[2,4],minWidth:"320px",maxWidth:"580px",width:"80%",textAlign:"center"},children:_&&(0,J.jsx)(ae,{currentArtifact:n?.me?.account?.hero?.equipment?.artifact??null,newArtifact:_})})}),(0,J.jsx)(w.ZP,{value:j,children:(0,J.jsx)(S.Z,{onChange:function(e,t){s&&r(!1),p(t)},"aria-label":"navigation tabs",variant:"scrollable",children:Object.keys(b).map((e=>(0,J.jsx)(d.Z,{label:e,value:e},e)))})}),"notifications"!==j&&(0,J.jsxs)(E.Z,{sx:{marginTop:1},fullWidth:!0,variant:"outlined",children:[(0,J.jsx)(q.Z,{htmlFor:"chat-input",children:Q}),(0,J.jsx)(W.Z,{disabled:!f.current?.connected,value:x,id:"chat-input",name:"Chat input",label:Q,placeholder:"Type here...",onChange:function(e){const{value:t}=e.target;v(t).length<=140&&g(t)},onFocus:()=>u(!0),onBlur:()=>u(!1),autoComplete:"off",onKeyPress:function(e){"Enter"===e.key&&P()},endAdornment:(0,J.jsxs)(F.Z,{position:"end",children:[(0,J.jsx)(B.Z,{title:"Send message",children:(0,J.jsx)(M.Z,{"aria-label":"send chat",onClick:P,children:(0,J.jsx)(T.Z,{})})}),"private"===b[j]?.type&&(0,J.jsx)(B.Z,{title:s?"Cancel trade":"Trade with player",children:(0,J.jsxs)(M.Z,{onClick:()=>r(!s),children:[s&&(0,J.jsx)(H.Z,{}),!s&&(0,J.jsx)(G.Z,{})]})})]})})]}),s&&t&&b[j]?.heroId&&(0,J.jsx)(Y,{hero:t,to:b[j].heroId??""}),(0,J.jsx)(l.Z,{sx:{padding:1,minHeight:"600px",bgcolor:"background.paper"},children:K.map((e=>(0,J.jsxs)(h.Z,{variant:e.variant||"body1",sx:{color:`${"private"===e.type?"secondary":e.color||"text"}.main`},children:[e.time&&(0,J.jsxs)(h.Z,{variant:"caption","aria-hidden":"true",children:["(",(0,L.S)(new Date(1e3*e.time)),")\xa0"]}),e.heroId&&(0,J.jsx)(Z.Z,{onClick:()=>{var t,n;e.heroId&&(t=e.from,n=e.heroId,y((e=>({...e,[t]:{type:"private",heroId:n}}))),p(t))},sx:{color:"inherit",textTransform:"none",paddingTop:0,paddingBottom:0,paddingLeft:1,paddingRight:.5,margin:0},children:(0,J.jsxs)("b",{children:[e.from,":"]})}),!e.heroId&&(0,J.jsx)("b",{children:e.from})," ",(0,$.emojify)(e.message)," ",e.time&&(0,J.jsxs)(h.Z,{variant:"caption",sx:C.Z,children:["(",(0,L.S)(new Date(1e3*e.time)),")\xa0"]})]},e.id)))}),(0,J.jsx)("br",{})]})}var le=n(1409),oe=n(2437);function ce(){const e=R(),{data:t}=(0,z.W1t)({variables:e?.location?{location:{x:e.location.x,y:e.location.y,map:e.location.map}}:void 0,skip:!e?.location});return t?.locationDetails??null}function de(){const e=ce()?.specialLocations||[];return e.length?e[0]:null}var he=n(2734),me=n(1737),ue=n(6012),xe=n(5499),ge=n(8698),je=n(7600),pe=n(5826),be=n(9994);const ye={[z.zPP.Fire]:"Fireball",[z.zPP.Ice]:"Blizzard",[z.zPP.Lightning]:"Lightning Bolt",[z.zPP.Blight]:"Wrathful"},fe={[z.zPP.Normal]:"Normal stance with no pros or cons.",[z.zPP.Reckless]:"Double accuracy but makes you twice as easy to hit.",[z.zPP.Fire]:"Converts 20% of magic damage into Fire damage.",[z.zPP.Ice]:"Converts 20% of magic damage into Ice damage.",[z.zPP.Lightning]:"Converts 20% of magic damage into Lightning damage.",[z.zPP.Sunder]:"Converts 50% of damage into Physical damage.",[z.zPP.Blight]:"Changes base damage type of smite from Holy to Blight."};function Ze(e){const t=R(),[n,a]=(0,i.useState)(t?.activeStance||z.zPP.Normal);if(!t)return null;const s=t.availableStances.map((e=>({name:ye[e]??e,stance:e,tooltip:fe[e]})));return s.length<2?null:(0,J.jsx)(m.ZP,{item:!0,xs:12,children:(0,J.jsxs)(m.ZP,{container:!0,sx:{textAlign:"center"},columns:6,spacing:2,children:[(0,J.jsx)(m.ZP,{item:!0,xs:6,children:(0,J.jsx)(o.Z,{})}),(0,J.jsx)(m.ZP,{item:!0,xs:6,children:(0,J.jsx)(h.Z,{variant:"h5",children:"Select Combat Style"})}),s.map((t=>(0,J.jsx)(m.ZP,{item:!0,lg:1,md:2,sm:3,xs:6,children:(0,J.jsx)(B.Z,{title:t.tooltip,children:(0,J.jsx)(Z.Z,{variant:n===t.name?"outlined":"text",sx:{fontSize:"1rem",padding:2},size:"large",id:`set-stance-${t.name.toLowerCase()}`,onClick:()=>function(t){a(t),e.onChange&&e.onChange(t)}(t.stance),"aria-label":`set stance ${t.name}`,children:t.name})})},t.name)))]})})}function ve({log:e}){(0,he.Z)();const t=(0,i.useMemo)((()=>e?.[0]?.time??3e3),[e]),[n,a]=(0,i.useState)(-1),s=(0,i.useRef)([]);return(0,i.useEffect)((()=>{s.current.forEach((e=>clearTimeout(e))),s.current=[];const n=e.reduce(((e,n,i)=>t-n.time===0?i:e),-1);return a(n),e.forEach(((e,n)=>{const i=Math.max(0,t-e.time)/6;if(0===i)return;const r=window.setTimeout((()=>{a((e=>Math.max(e,n)))}),i);s.current.push(r)})),()=>{s.current.forEach((e=>clearTimeout(e))),s.current=[]}}),[e,t]),(0,J.jsx)(l.Z,{role:"log","aria-live":"polite","aria-relevant":"additions",children:e.map(((e,a)=>{const s=a<=n;return(0,J.jsxs)(h.Z,{sx:{transition:"opacity 250ms ease-in",opacity:s?1:0,visibility:s?"visible":"hidden"},"aria-hidden":!s,children:["+",(t-e.time)/1e3,"s ",e.isEnchantment?(0,J.jsx)(i.Fragment,{children:e.damage<0?(0,J.jsxs)(i.Fragment,{children:[(0,J.jsx)("b",{children:e.from})," heals"," ",(0,J.jsx)("span",{id:`fight-${e.from}-enchantment-heal`,children:(0-e.damage).toLocaleString()})," ","health from their enchantments"]}):(0,J.jsxs)(i.Fragment,{children:[(0,J.jsx)("b",{children:e.from})," dealt"," ",(0,J.jsx)("span",{id:`fight-${e.from}-enchantment-damage`,children:e.damage.toLocaleString()})," ","enchantment damage to ",(0,J.jsx)("b",{children:e.to})]})}):(0,J.jsxs)(i.Fragment,{children:[(0,J.jsx)("b",{children:e.from}),` ${we(e.attackType,e.success,e.critical)} `,(0,J.jsx)("b",{children:e.to}),e.success?` for ${e.damage.toLocaleString()} ${e.damageType?e.damageType.toLowerCase():""} damage!`:"."]})]},`${e.from}-${a}`)}))})}function we(e,t,n){switch(e){case z.hKe.Blood:return t?n?"surges with blood magic against":"lets blood and casts forth towards":"attempts to cast a spell against";case z.hKe.Smite:return t?n?"summons powers beyond this world against":"smites":"attempts to smite";case z.hKe.Cast:return t?n?"carefully casts a powerful spell against":"shoots a magical bolt at":"attempts to cast a spell against";case z.hKe.Ranged:return t?n?"lands a sneak attack from the shadows, critically damaging":"fires an arrow at":"shoots an arrow but it misses";case z.hKe.Melee:default:return t?n?"lands a crippling blow against":"struck":"missed"}}function Se(e){const{autoBattle:t,canAutoBattle:n,fight:{id:a,monster:s},onVictory:r,onRematch:o,rematchLabel:d,onError:u,onAutoBattle:x,fightMutationRef:g,duel:j,hero:p,isChallengable:b}=e,[y,f]=(0,i.useState)(!1),[v,{data:w,loading:S}]=(0,z.zC)(),[k,{data:C,loading:P}]=(0,z.E0W)(),[A,$]=(0,i.useState)(100),[L,I]=(0,i.useState)(p.availableAttacks?.[0]??z.hKe.Melee),F=w?.fight||C?.attackHero||null,M=w?.fight?.monster?.monster||C?.attackHero?.otherHero||null,E=(0,he.Z)(),[q,W]=(0,i.useState)(p.activeStance||z.zPP.Normal),D=!t&&n;async function T(e){I(e);try{if(j){(await k({variables:{id:a,attackType:e,stance:q}})).data?.attackHero.victory&&r&&r()}else{(await v({variables:{monster:a,attackType:e,stance:q}})).data?.fight.victory&&r&&r()}}catch(t){if(t.graphQLErrors&&t.graphQLErrors[0]){const[e]=t.graphQLErrors;if(e.extensions?.delay)return;if(e.message.startsWith("Key not found in database"))return f(!0),void $(0)}u&&u(t)}}return(0,i.useEffect)((()=>{p.availableAttacks.includes(L)||I(p.availableAttacks?.[0]??z.hKe.Melee)}),[p.availableAttacks.join("|")]),(0,i.useEffect)((()=>{y&&f(!1),S||P||$(100*(M?M.combat.health:s.combat.health)/s.combat.maxHealth)}),[M?.combat.health,M?.combat.maxHealth,s.combat.maxHealth]),g&&(g.current=T),(0,i.useEffect)((()=>()=>{g&&(g.current=()=>{})}),[]),(0,J.jsxs)(i.Fragment,{children:[!t&&(0,J.jsx)(Ze,{onChange:W}),(0,J.jsxs)(m.ZP,{id:"combat-display",sx:{position:"relative",minHeight:"320px",[E.breakpoints.down("md")]:{minHeight:"450px"},[E.breakpoints.down("sm")]:{minHeight:"580px"},[E.breakpoints.down("xs")]:{minHeight:"660px"}},item:!0,xs:6,children:[(0,J.jsxs)(m.ZP,{container:!0,sx:{textAlign:"center"},columns:6,children:[(0,J.jsxs)(m.ZP,{item:!0,xs:6,children:[(0,J.jsxs)(h.Z,{variant:"h4",children:[A>0&&(t?"Auto-Battling":"Battling"),A<=0&&"Dead"," ",s.name]}),(0,J.jsx)(c.Z,{variant:"determinate",value:A,color:"error"})]}),A>0&&(0,J.jsxs)(i.Fragment,{children:[p.availableAttacks.includes(z.hKe.Melee)&&(0,J.jsx)(m.ZP,{item:!0,xs:6,sm:3,md:2,xl:2,children:(0,J.jsx)(B.Z,{title:"Attack using your melee weapons, uses strength and dexterity",describeChild:!0,children:(0,J.jsx)(Z.Z,{sx:{fontSize:"1rem",padding:2},size:"large",id:"attack-with-melee",onClick:()=>T(z.hKe.Melee),"aria-label":"melee attack",startIcon:(0,J.jsx)(ue.Z,{}),children:"Melee attack"})})}),p.availableAttacks.includes(z.hKe.Ranged)&&(0,J.jsx)(m.ZP,{item:!0,xs:6,sm:3,md:2,xl:2,children:(0,J.jsx)(B.Z,{title:"Attack using your ranged weapons, uses dexterity",describeChild:!0,children:(0,J.jsx)(Z.Z,{sx:{fontSize:"1rem",padding:2},size:"large",id:"attack-with-ranged",onClick:()=>T(z.hKe.Ranged),"aria-label":"ranged attack",startIcon:(0,J.jsx)(xe.Z,{}),children:"Ranged attack"})})}),p.availableAttacks.includes(z.hKe.Cast)&&(0,J.jsx)(m.ZP,{item:!0,xs:6,sm:3,md:2,xl:2,children:(0,J.jsx)(B.Z,{title:"Cast spells using your wisdom and intelligence",describeChild:!0,children:(0,J.jsx)(Z.Z,{sx:{fontSize:"1rem",padding:2},size:"large",id:"attack-with-cast",onClick:()=>T(z.hKe.Cast),"aria-label":"cast spell",startIcon:(0,J.jsx)(ge.Z,{}),children:"Cast Spell"})})}),p.availableAttacks.includes(z.hKe.Smite)&&(0,J.jsx)(m.ZP,{item:!0,xs:6,sm:3,md:3,xl:3,children:(0,J.jsx)(B.Z,{title:"Smite your foe using wisdom and willpower",describeChild:!0,children:(0,J.jsx)(Z.Z,{sx:{fontSize:"1rem",padding:2},size:"large",id:"attack-with-holy",onClick:()=>T(z.hKe.Smite),"aria-label":"holy attack",startIcon:(0,J.jsx)(je.Z,{}),children:"Smite"})})}),p.availableAttacks.includes(z.hKe.Blood)&&(0,J.jsx)(m.ZP,{item:!0,xs:6,sm:6,md:3,xl:3,children:(0,J.jsx)(B.Z,{title:"Damage yourself to damage the enemy, uses constitution",describeChild:!0,children:(0,J.jsx)(Z.Z,{sx:{fontSize:"1rem",padding:2},size:"large",id:"attack-with-blood",onClick:()=>T(z.hKe.Blood),"aria-label":"blood magic",startIcon:(0,J.jsx)(pe.Z,{}),children:"Blood magic"})})})]}),A<=0&&!!o&&b&&(0,J.jsx)(B.Z,{title:"Summon a new instance of this monster and fight it",describeChild:!0,children:(0,J.jsx)(Z.Z,{fullWidth:!0,sx:{fontSize:"1rem",padding:2},size:"large",id:"respawn-monster",onClick:()=>o?.(s.id),"aria-label":"respawn monster",startIcon:(0,J.jsx)(be.Z,{}),children:d??`Spawn new ${s.name}`})})]}),y&&"This enemy was killed by another player",F&&(0,J.jsx)(ve,{log:F.log}),F&&F.victory&&(0,J.jsxs)(i.Fragment,{children:[(0,J.jsxs)(me.Z,{id:"fight-did-win",severity:"success",sx:{mt:2},children:[s.name," has been killed!",(F.experience||F.gold)&&" You gain ",F.gold&&(0,J.jsxs)(i.Fragment,{children:[" ",(0,J.jsx)("span",{id:"fight-recap-gold",children:F.gold.toLocaleString()})," ","gold"]}),F.gold&&F.experience&&" and",F.experience&&(0,J.jsxs)(i.Fragment,{children:[" ",(0,J.jsx)("span",{id:"fight-recap-experience",children:F.experience.toLocaleString()})," ","experience"]}),(F.experience||F.gold)&&"!! ",F.didLevel&&(0,J.jsx)("b",{id:"fight-level-up",children:"You leveled up!!"})]}),F.drop&&(0,J.jsxs)(me.Z,{id:"fight-got-drop",severity:"info",sx:{mt:2},children:["You find an enchanted item on the monster's corpse! "," ",(0,J.jsx)("b",{children:(0,N.GJ)(F.drop)})]})]}),(0,J.jsx)(l.Z,{sx:{mt:2}}),D&&(0,J.jsx)(Z.Z,{fullWidth:!0,color:"secondary",variant:"contained",onClick:()=>{x&&x(s.id,L)},children:"Auto-Battle this enemy"})]})]})}var ke=n(2401),Ce=n(1233);function Pe(){const{data:e}=(0,z.UEB)({fetchPolicy:"cache-only"}),{data:t}=(0,z.pLI)(),n=(e?.me?.account?.hero??null)?.dungeon??null;if(!n)return null;const i=n.remaining.length,a=Math.max(0,Math.min(n.index,i)),s=n.remaining,r=e=>{const n=t?.challenges?.find((t=>t.id===e));return n?n.name:e};let l=null;if("LockedOrder"===n.selection){const e=s[Math.max(0,Math.min(n.index,i-1))],t=e?r(e):void 0;l=(0,J.jsxs)(h.Z,{variant:"body2",children:["Step ",Math.min(a+1,i)," of ",i,t?` \u2014 Next: ${t}`:null]})}else{const e=s.map(r).slice(0,5),t=s.length-e.length;l=(0,J.jsxs)(h.Z,{variant:"body2",children:["Remaining ",s.length,e.length>0?` \u2014 Allowed: ${e.join(", ")}${t>0?`, +${t} more`:""}`:null]})}const o=n.lockedLocation?(0,J.jsxs)(h.Z,{variant:"caption",color:"text.secondary",children:["Movement locked at ",n.lockedLocation.x,", ",n.lockedLocation.y," (",n.lockedLocation.map,")"]}):null;return(0,J.jsx)(Ce.Z,{sx:{mb:2},children:(0,J.jsxs)(me.Z,{severity:"info",variant:"outlined",children:[(0,J.jsx)(ke.Z,{children:"Dungeon Active"}),l,o]})})}function Ae(){const[e,t]=(0,i.useState)(z.hKe.Melee),[n,a]=(0,i.useState)(0),[s,r]=(0,i.useState)(0),[l,o]=(0,i.useState)([0,50,100]),d=(0,i.useRef)((()=>{})),[u,x]=(0,i.useState)(!1),[g,j]=(0,i.useState)(""),[p,b]=(0,i.useState)(0),[y,f]=(0,i.useState)(null),[v,w]=(0,oe.gZ)(),[S,k]=(0,i.useState)("");let[C,P]=(0,i.useState)(""),[A,$]=(0,i.useState)("");const[L,I]=(0,i.useState)(""),{data:F,loading:M,error:W,refetch:B}=(0,z.OfX)(),[D]=(0,z.Htf)(),[T,{loading:G}]=(0,z.hLf)(),{data:H,refetch:_}=(0,z.pLI)();let Y=H?.challenges||[];const O=R(),[U,{data:V,loading:X}]=(0,z.zC)(),ee=(0,i.useRef)((e=>{}));let te=ce()?.players??[];const ne=F?.monsters?.find((e=>e.id===y)),ie=O?.dungeon??null,ae=ie?.selection===z.WKu.LockedOrder,se=ie?.selection===z.WKu.AnyOrder,re=ae&&ie?.remaining?.length?ie.remaining[Math.max(0,Math.min(ie.index,ie.remaining.length-1))]:null;let de=!1,he=0;O&&(de=!!O.inventory.find((e=>(0,N.h8)(e.baseItem))),he=O.inventory.filter((e=>(0,N.Ke)(e.baseItem))).length);const me=G||M||X;async function ue(){try{await T()}catch(e){e.graphQLErrors&&e.graphQLErrors[0]?.extensions?.delay&&w(e.graphQLErrors[0].extensions.remaining)}}async function xe(e){try{const{data:t}=await D({variables:{monster:e}});await B(),t?.challenge&&f(t.challenge.id),t?.challenge?.id&&P(t?.challenge?.id),b(p+1),I("")}catch(t){B()}}(0,i.useEffect)((()=>(window.setChallengeMonster=k,()=>{delete window.setChallengeMonster})),[k]),(0,i.useEffect)((()=>{_(),B()}),[O?.location.x,O?.location.y,O?.location.map]),d.current=async()=>{if(r((s+1)%(4/Math.pow(2,he))),o([Math.random()>.5?100*Math.random():l[0],Math.random()>.5?100*Math.random():l[1],Math.random()>.5?100*Math.random():l[2]]),0!==s)return;if(me||v>0)return;if(0===O?.combat.health)return console.log("[AutoBattler] Healing!"),ue();let t=g;return ae?t=re??null:se&&ie?.remaining?.length&&(t=ie.remaining.includes(g)?g:ie.remaining[0]??null),!ne||0===ne.monster.combat.health||t&&ne.monster.id!==t?t?(console.log("[AutoBattler] Challenging new mob!",t),void xe(t)):(console.log("[AutoBattler] No valid target; disabling auto-battle."),void x(!1)):ne&&ee.current?(console.log(`[AutoBattler] Fighting ${e}!`),void ee.current(e)):void console.log("[AutoBattler] Doing nothing...")},(0,i.useEffect)((()=>{if(!u||!g.length)return;const e=(0,le.Zi)((()=>{d.current()}),500);return()=>{(0,le.cv)(e)}}),[u,he]),(0,i.useEffect)((()=>{if(F?.monsters?.length){let e=F.monsters.concat().sort(((e,t)=>e.monster.level-t.monster.level));if(se&&ie?.remaining?.length&&(e=e.filter((e=>ie.remaining.includes(e.monster.id)))),""===C)P(e[0]?.id??"");else{e.find((e=>e.id===C))||P(e[0]?.id??"")}}}),[C,F?.monsters?.length,se,ie?.remaining?.join("|")]);const ge=F?.monsters?.find((e=>e.id===C));ge||(C="");const je=te.find((e=>e.id===L));if(te.find((e=>e.id===A))||(A=""),!O)return null;O.levelCap>100||(Y=Y.slice(0,O.level)),se&&ie?.remaining?.length&&(Y=Y.filter((e=>ie.remaining.includes(e.id)))),te=te.filter((e=>e.combat.health>0));const pe="Select a new monster to challenge",be="Fight an existing monster!",ye="Duel with a nearby player!",fe=!(!ne||!Y.some((e=>e.id===ne.monster.id))),Ze=ae?!!re:fe,ve=!!(ae&&re&&ne&&ne.monster.id===re),we=!(!ae||!re||ve);return(0,J.jsxs)(i.Fragment,{children:[(0,J.jsx)(Pe,{}),(0,J.jsxs)(m.ZP,{container:!0,columns:6,spacing:4,children:[!u&&O&&O.combat.health>0&&(0,J.jsxs)(i.Fragment,{children:[!ae&&(0,J.jsx)(m.ZP,{item:!0,md:3,xs:6,children:(0,J.jsxs)(E.Z,{fullWidth:!0,children:[(0,J.jsx)(q.Z,{id:"challenge-monster-select-label",children:pe}),(0,J.jsx)(K.Z,{id:"challenge-select",labelId:"challenge-monster-select-label",value:S,label:pe,disabled:u,onChange:e=>k(e.target.value),children:Y.map((e=>(0,J.jsxs)(Q.Z,{value:e.id,children:[e.name,"\xa0",(0,J.jsxs)(h.Z,{variant:"caption",display:"inline-block",children:["Tier ",e.level]})]},e.id)))}),(0,J.jsx)(Z.Z,{id:"challenge-button",disabled:!S||v>0||G||u,onClick:async function(){return xe(S)},variant:"contained",children:"Challenge!"})]})}),!ae&&(0,J.jsx)(m.ZP,{item:!0,md:3,xs:6,children:(0,J.jsxs)(E.Z,{fullWidth:!0,children:[(0,J.jsx)(q.Z,{id:"fight-monster-select-label",children:be}),(0,J.jsx)(K.Z,{id:"fight-select",labelId:"fight-monster-select-label",value:C,label:be,disabled:u,onChange:e=>P(e.target.value),children:F?.monsters&&[...F?.monsters].sort(((e,t)=>e.monster.level-t.monster.level)).filter((e=>!se||!ie?.remaining?.length||ie.remaining.includes(e.monster.id))).map((e=>(0,J.jsxs)(Q.Z,{value:e.id,disabled:0===e.monster.combat.health,children:[0===e.monster.combat.health&&"Dead ",e.monster.name]},e.id)))}),(0,J.jsx)(Z.Z,{id:"fight-button",disabled:!C||v>0||G||ge&&0===ge.monster.combat.health||u,onClick:async function(){F?.monsters.find((e=>e.id===C)),f(C),I("")},variant:"contained",children:"Fight!"})]})}),ae&&we&&(0,J.jsx)(m.ZP,{item:!0,md:6,xs:6,children:(0,J.jsx)(Z.Z,{fullWidth:!0,id:"challenge-next-monster",variant:"contained",disabled:v>0||G||u,onClick:()=>re&&xe(re),children:"Challenge Next Monster"})}),!ie&&te.length>1&&(0,J.jsx)(m.ZP,{item:!0,md:3,xs:6,children:(0,J.jsxs)(E.Z,{fullWidth:!0,children:[(0,J.jsx)(q.Z,{id:"duel-select-label",children:ye}),(0,J.jsx)(K.Z,{id:"duel-select",labelId:"duel-select-label",value:A,label:ye,disabled:u,onChange:e=>$(e.target.value),children:te.filter((e=>e.id!==O.id)).sort(((e,t)=>e.level-t.level)).map((e=>(0,J.jsx)(Q.Z,{value:e.id,children:e.name},e.id)))}),(0,J.jsx)(Z.Z,{id:"duel-button",disabled:!A.length||v>0||G||u,onClick:async function(){I(A),f("")},variant:"contained",children:"Duel Player!"})]})})]}),u&&(0,J.jsxs)(m.ZP,{item:!0,xs:6,children:[(0,J.jsx)(c.Z,{sx:{margin:1,color:"#f00"},variant:"determinate",value:l[0],color:"inherit"}),(0,J.jsx)(c.Z,{color:"inherit",sx:{margin:1,color:"#0f0"},variant:"determinate",value:l[1]}),(0,J.jsx)(c.Z,{color:"inherit",sx:{margin:1,color:"#00f"},variant:"determinate",value:l[2]}),(0,J.jsx)(Z.Z,{fullWidth:!0,variant:"contained",color:"error",size:"large",onClick:()=>x(!1),children:"Disable Auto-Battle"})]}),O&&O.combat.health<=0&&(0,J.jsx)(m.ZP,{item:!0,lg:3,xs:6,children:(0,J.jsx)(h.Z,{id:"you-are-dead",children:"You are dead."})}),ne&&(0,J.jsx)(i.Fragment,{children:(0,J.jsx)(Se,{hero:O,fight:ne,onError:()=>{B(),f(null)},autoBattle:u,canAutoBattle:de,onAutoBattle:async function(e,n){console.log("Enabling auto battler! weee!"),x(!0),t(n),a(0),j(e)},onRematch:e=>{xe(ae&&re?re:e)},rematchLabel:ae?"Challenge Next Monster":void 0,fightMutationRef:ee,onVictory:()=>a(n+1),isChallengable:Ze},`${ne.id}-${p}`)}),je&&(0,J.jsx)(i.Fragment,{children:(0,J.jsx)(Se,{hero:O,fight:{id:je.id,monster:je},onError:()=>{B(),f(null)},duel:!0,autoBattle:!1,canAutoBattle:!1,isChallengable:fe},`${je.id}-${p}`)}),(0,J.jsx)(m.ZP,{item:!0,lg:3,xs:6,children:(0,J.jsx)(Z.Z,{id:"heal-button",fullWidth:!0,onClick:ue,variant:"contained",disabled:v>0||G||O&&O.combat.health===O.combat.maxHealth,children:"Heal"})})]})]})}var $e=n(1767),Le=n(813),Ie=n(5503),Fe=n(6172),Me=n(8317);const Ee=n(4351).Z.table`
  border-collapse: collapse;

  tr {
    margin: 0px;
    padding: 0px;
    td {
      position: relative;
      width: ${({cellSize:e})=>e}px;
      height: ${({cellSize:e})=>e}px;
      overflow: visible;
      margin: 0px;
      padding: 0px;
    }
  }
`;function qe({location:e,minimapSize:t=[24,24],gridSize:n=[128,96],cellSize:i=16,renderCell:a=(()=>null)}){const s=[Math.round(Math.min(n[0]-t[0],Math.max(0,e.x-t[0]/2))),Math.round(Math.min(n[1]-t[1],Math.max(0,e.y-t[1]/2)))];return(0,J.jsx)("div",{style:{position:"relative",display:"inline-block",backgroundImage:`url(/maps/${e.map}.jpg)`,backgroundPosition:`-${s[0]*i}px -${s[1]*i}px`,backgroundSize:`${128*i}px ${96*i}px `,width:t[0]*i+"px",height:t[1]*i+"px"},children:(0,J.jsx)(Ee,{cellSize:i,children:(0,J.jsx)("tbody",{children:[...Array(t[1])].map(((e,n)=>(0,J.jsx)("tr",{children:[...Array(t[0])].map(((e,t)=>(0,J.jsx)("td",{children:a({x:s[0]+t,y:s[1]+n})},`cell-${s[0]+t}-${s[1]+n}`)))},`row-${s[1]+n}`)))})})})}function We({location:e}){const t=R(),[n,{loading:a}]=(0,z.L7b)(),{data:s}=(0,z.dEQ)(),[r,o]=(0,i.useState)(""),c="Choose a port to sail to",d=!!t?.dungeon?.lockedLocation;function m(t){return(0,N.LW)(t.location,e.location)}function u(t){return Math.round(12*(0,N.LW)(t.location,e.location))}return(0,J.jsxs)(l.Z,{children:[(0,J.jsx)(h.Z,{variant:"h5",children:e.name}),(0,J.jsx)(h.Z,{children:d?`Movement locked at ${t?.dungeon?.lockedLocation?.x}, ${t?.dungeon?.lockedLocation?.y} (${t?.dungeon?.lockedLocation?.map}).`:"The wooden docks creak and sway with the water below."}),(0,J.jsxs)(E.Z,{fullWidth:!0,children:[(0,J.jsx)(q.Z,{id:"sail-dock-select-label",children:c}),(0,J.jsx)(K.Z,{id:"sail-select",labelId:"sail-dock-select-label",value:r,label:c,onChange:e=>o(e.target.value),disabled:d,children:s?.docks&&[...s?.docks].sort(((e,t)=>m(e)-m(t))).map((t=>(0,J.jsxs)(Q.Z,{value:t.name,disabled:t.name===e.name,children:[t.name,":"," ",t.name!==e.name&&(0,J.jsxs)(i.Fragment,{children:[u(t).toLocaleString()," Gold"]}),t.name===e.name&&"Current location"]},t.name)))}),(0,J.jsx)(Z.Z,{onClick:function(){if(!s)return;const e=s.docks.find((e=>e.name===r));e&&n({variables:{x:e.location.x,y:e.location.y}})},variant:"outlined",color:"success",disabled:d||!r.length||a,children:"Sail!"})]})]})}var Be=n(6205);function De({shop:e}){const[t,n]=(0,i.useState)(!1),[a,s]=(0,i.useState)(""),[r,{loading:l}]=(0,z.NAy)();return(0,J.jsxs)(i.Fragment,{children:[(0,J.jsx)(o.Z,{sx:{mt:1,mb:1}}),(0,J.jsx)(h.Z,{variant:"h4",component:"h5",color:"info.main",children:e.name}),(0,J.jsx)(h.Z,{sx:{mb:2},variant:"subtitle2",color:"info.main",children:"Hermit shop"}),a.length>0&&(0,J.jsx)(h.Z,{sx:{mb:2},variant:"body1",color:t?"success.main":"error.main",children:a}),e.trades.map(((e,t)=>(0,J.jsx)(i.Fragment,{children:(0,J.jsxs)(h.Z,{children:[(0,J.jsx)(Te,{trade:e}),(0,J.jsx)(Z.Z,{disabled:l,onClick:()=>async function(e){console.log("attemptiong trade",e),s("");try{const t=await r({variables:{trade:e}});t?.data?.npcTrade&&(s(t.data.npcTrade.message),n(t.data.npcTrade.success))}catch(t){}}(e.id),sx:{ml:1},children:"Trade"})]})},`npc shop items ${t}`)))]})}function Te({trade:e}){return(0,J.jsxs)(i.Fragment,{children:["For the price of ",(0,J.jsx)(Ge,{price:e.price}),", I'll give you"," ",(0,J.jsx)(Ge,{price:e.offer})]})}function Ge({price:e}){return(0,J.jsx)(B.Z,{title:He(e),describeChild:!0,children:(0,J.jsx)(Be.Z,{style:{background:"none",border:"none"},"aria-label":He(e),children:e.description})})}function He(e){let t=[];return e.gold&&t.push(`${e.gold.toLocaleString()} gold`),e.dust&&t.push(`${e.dust.toLocaleString()} dust`),e.baseItems?.length&&e.baseItems.forEach((e=>{t.push(`${e}`)})),e.enchantments?.length&&e.enchantments.forEach((e=>{t.push(`${(0,N.uD)(e)}`)})),e.questItems?.length&&e.questItems.forEach((e=>{t.push(`${e}`)})),t.length?t.join(", "):"???"}var ze=n(3020),Re=n(2023),Ne=n(9748),Ke=n(8951),Qe=n(1812),_e=n(7855),Je=n(3707),Ye=n(5843);function Oe({hero:e,camp:t,onBuyResource:n}){const[a,s]=(0,i.useState)(!1),[r,{loading:o}]=(0,z.G_X)(),[c,{loading:d}]=(0,z.jEK)();z.G_X;const[u,x]=(0,i.useState)(""),[g,j]=(0,i.useState)(""),p=d||o;const b=!!t.upgrades.find((e=>e===z.gTu.TradingPost)),y=!u.length||!g.length||Number(g)<1||isNaN(Number(g))||!Number.isFinite(Number(g));return(0,J.jsx)(l.Z,{children:(0,J.jsxs)(m.ZP,{container:!0,columns:6,spacing:1,children:[b&&(0,J.jsx)(m.ZP,{item:!0,xs:6,children:(0,J.jsxs)(Ce.Z,{direction:"row",spacing:1,alignItems:"center",children:[(0,J.jsx)(h.Z,{children:"Buy"}),(0,J.jsx)(Ye.Z,{color:"success",checked:a,onChange:e=>s(e.target.checked)}),(0,J.jsx)(h.Z,{children:"Sell"})]})}),(0,J.jsx)(m.ZP,{item:!0,xs:6,sm:3,children:(0,J.jsxs)(E.Z,{fullWidth:!0,sx:{mt:1,minWidth:200},children:[(0,J.jsxs)(q.Z,{children:["Select resource to ",a?"sell":"buy"]}),(0,J.jsxs)(K.Z,{label:"Select resource to "+(a?"sell":"buy"),value:u,onChange:e=>x(e.target.value),children:[(0,J.jsx)(Q.Z,{value:"wood",children:"Wood"}),(0,J.jsx)(Q.Z,{value:"food",children:"Food"}),(0,J.jsx)(Q.Z,{value:"water",children:"Water"}),(0,J.jsx)(Q.Z,{value:"stone",children:"Stone"})]})]})}),(0,J.jsx)(m.ZP,{item:!0,xs:6,sm:3,children:(0,J.jsx)(E.Z,{fullWidth:!0,sx:{mt:1,minWidth:200},children:(0,J.jsx)(_.Z,{label:"Amount to "+(a?"sell":"buy"),value:g,onChange:e=>j(e.target.value)})})}),(0,J.jsx)(m.ZP,{item:!0,xs:6,children:(0,J.jsx)(E.Z,{fullWidth:!0,children:(0,J.jsxs)(Qe.Z,{color:a?"success":"error",loading:p,variant:"contained",disabled:y,onClick:async function(){try{const e=a?r:c;await e({variables:{amount:Number(g),resource:u}}),j(""),x(""),n&&n()}catch(e){}},children:[a&&"Sell ",!a&&"Buy ",y&&"Resources",!y&&`${u} for ${(1e4*Number(g)).toLocaleString()} Gold`]})})})]})})}function Ue({hero:e,onShowSettlement:t}){const n=de();let i=!1;return e.home&&e.home.location.x===e.location.x&&e.home.location.y===e.location.y&&e.home.location.map===e.location.map&&(i=!0),n&&"altar"!==n.type||!e.home&&e.gold<1e5?null:(0,J.jsxs)(l.Z,{children:[!e.home&&(0,J.jsx)(Ve,{hero:e}),e.home&&(0,J.jsx)(Xe,{isLocal:i,hero:e,onShowSettlement:t}),(0,J.jsx)(o.Z,{sx:{mt:2,mb:2}})]})}function Ve({hero:e}){const[t,{loading:n}]=(0,z.kOX)();return(0,J.jsxs)(l.Z,{children:[(0,J.jsx)(h.Z,{component:"h2",variant:"h5",sx:{mb:2},children:"Settle Camp"}),(0,J.jsx)(h.Z,{sx:{mb:2},children:"Settling a camp site allows you to heal faster while standing on that square. Additionally, you'll be able to upgrade the camp site to gain additional features and upgrades."}),(0,J.jsxs)(Qe.Z,{loading:n,color:"success",onClick:async function(){try{await t()}catch(e){}},sx:{p:2},startIcon:(0,J.jsx)(_e.Z,{}),children:["Settle Camp for ",1e5.toLocaleString()," Gold"]})]})}function Xe({hero:e,isLocal:t,onShowSettlement:n}){const[a,s]=(0,i.useState)(!1),[r,o]=(0,i.useState)(!1),[c,{loading:d}]=(0,z.kOX)();if(!e.home)return null;const m=!!e.home.upgrades.find((e=>e===z.gTu.TradingPost)),u=!!e.home.upgrades.find((e=>e===z.gTu.Settlement));if(!t)return(0,J.jsxs)(l.Z,{children:[(0,J.jsxs)(X.Z,{open:a,onClose:()=>s(!1),"aria-labelledby":"confirmation-title","aria-describedby":"confirmation-description",children:[(0,J.jsxs)(ee.Z,{id:"confirmation-title",children:[!u&&"Destroy existing campsite?",u&&"Destroy settlement capital?"]}),(0,J.jsx)(te.Z,{children:(0,J.jsxs)(Ke.Z,{id:"confirmation-description",children:["Settling a new camp here will leave your old"," ",u?"settlement":"campsite"," abandoned. You will lose any upgrades or anything stored there."]})}),(0,J.jsxs)(ne.Z,{children:[(0,J.jsx)(Qe.Z,{color:"error",loading:d,onClick:()=>s(!1),children:"Nevermind"}),(0,J.jsx)(Qe.Z,{color:"success",loading:d,onClick:async function(){s(!1);try{await c()}catch(e){}},autoFocus:!0,children:"Re-Settle Camp"})]})]}),(0,J.jsxs)(h.Z,{sx:{mb:2},component:"h2",children:["Your ",u?"settlement":"campsite"," is at"," ",(0,J.jsxs)("b",{children:[e.home.location.x,", ",e.home.location.y]}),". You must be at your ",u?"settlement":"campsite"," to interract with it."]}),(0,J.jsxs)(Qe.Z,{loading:d,color:"error",onClick:()=>s(!0),sx:{p:2},startIcon:(0,J.jsx)(Je.Z,{}),children:["Rebuild Camp HERE for ",1e5.toLocaleString()," Gold"]})]});const x=u?"Manage Settlement":"Manage Campsite";return(0,J.jsxs)(l.Z,{children:[(0,J.jsxs)(X.Z,{open:r,onClose:()=>o(!1),"aria-labelledby":"manage-camp-title","aria-describedby":"manage-camp-description",children:[(0,J.jsx)(ee.Z,{id:"manage-camp-title",children:x}),(0,J.jsxs)(te.Z,{children:[(0,J.jsx)(et,{camp:e.home}),(0,J.jsxs)(Ke.Z,{id:"manage-camp-description",children:["The fire crackles and pops as you work.",!u&&" Your tools and supplies lie staggered across the campsite.",u&&" Your tools sit organized in the shed, spare the ones in use"]}),(0,J.jsx)(Oe,{hero:e,camp:e.home}),m&&(0,J.jsx)(nt,{hero:e,camp:e.home}),(0,J.jsx)(tt,{hero:e,camp:e.home})]}),(0,J.jsx)(ne.Z,{children:(0,J.jsx)(Qe.Z,{color:"success",loading:d,onClick:()=>o(!1),children:"Done"})})]}),(0,J.jsxs)(h.Z,{variant:"h5",component:"h2",sx:{mb:2},children:["Your ",u?"Settlement":"Campsite"]}),(0,J.jsx)(h.Z,{sx:{mb:2},children:"The fire crackles and pops as it burns through the night."}),(0,J.jsxs)(Qe.Z,{color:"warning",variant:"contained",loading:d,onClick:()=>u&&n?n():o(!0),startIcon:(0,J.jsx)(_e.Z,{}),children:["Open ",u?"Settlement":"Camps"," Management"]})]})}function et({camp:e}){const{upkeep:t}=e;return(0,J.jsx)(m.ZP,{container:!0,columns:8,children:e.resources.map((({name:e,value:n,maximum:i})=>{let a=!1;return e in t&&(a=t[e]??!1),(0,J.jsxs)(m.ZP,{item:!0,xs:8,sm:4,md:2,children:[(0,J.jsx)("b",{children:(0,ze.words)(e)}),":"," ",0===n?(0,J.jsx)(h.Z,{sx:{display:"inline-block"},color:"error",children:n.toLocaleString()}):n.toLocaleString()," ","/ ",i&&i.toLocaleString(),a&&(0,J.jsxs)(h.Z,{color:24*a>n?"error":"",component:"span","aria-label":`Upkeep: ${a}`,children:[" ","-",a.toLocaleString()]})]},e)}))})}function tt({hero:e,camp:t}){const[n,{loading:i}]=(0,z.Ths)(),{data:a,refetch:s}=(0,z.HkW)(),r=a?.availableUpgrades??[],[o]=(0,oe.gZ)(),c=o>0;if(!r.length)return null;const d=!!t.upgrades.find((e=>e===z.gTu.Settlement));return(0,J.jsxs)(l.Z,{children:[(0,J.jsxs)(h.Z,{variant:"h6",children:[d?"Settlement":"Camp"," Upgrades"]}),(0,J.jsx)(m.ZP,{container:!0,columns:6,spacing:2,children:r.map((t=>{return(0,J.jsx)(m.ZP,{item:!0,xs:3,children:(0,J.jsxs)(g.Z,{variant:"outlined",children:[(0,J.jsx)(Ne.Z,{title:t.name}),(0,J.jsx)(j.Z,{children:(0,J.jsxs)(h.Z,{variant:"body2",color:"text.secondary",children:["Cost:"," ",t.cost.map((e=>`${e.value.toLocaleString()} ${(0,ze.words)(e.name)}`)).join(", ")]})}),(0,J.jsx)(Re.Z,{children:(0,J.jsx)(Qe.Z,{disabled:c,loading:i,sx:{m:1},variant:"outlined",color:(a=t.cost,(a.find((e=>"gold"===e.name))?.value??0)>e.gold?"error":"success"),onClick:()=>async function(e){try{await n({variables:{upgrade:e}}),await s()}catch(t){}}(t.type),children:"Purchase"})})]})},t.type);var a}))})]})}function nt({hero:e,camp:t}){return null}var it=n(1730),at=n(2613),st=n(3054),rt=n(7563),lt=n(6398),ot=n(6667),ct=n(3898),dt=n(1733),ht=n(1671),mt=n(1749),ut=n(4231);var xt=n(7234);function gt({location:e,icon:t,cellSize:n,boundingBox:i,tooltip:a,hover:s=!1,onClick:r,color:l="white",bgcolor:o}){e.x,i.min.x,e.y,i.min.y;return(0,J.jsx)(B.Z,{describeChild:!0,title:`${e.x}, ${e.y}: ${a}`,children:(0,J.jsx)(M.Z,{onClick:r,sx:{display:"flex",justifyContent:"center",alignItems:"center",width:`${n}px`,height:`${n}px`,color:l,backgroundColor:o,border:`1px solid ${l}`,"&:hover":{backgroundColor:(0,xt.Z)(o||l).setAlpha(o?s?.2:.8:s?.7:.1).toRgbString()}},children:t})})}function jt({cellSize:e,x:t,y:n,capital:a,type:s,range:r,boundingBox:l}){const[o]=(0,z.iAZ)(),c=a.connections.map((e=>e.location)).concat(a.location),d=(0,i.useMemo)((()=>{if(Math.abs(t-a.location.x)+Math.abs(n-a.location.y)>=r)return null;if(c.find((e=>e.x===t&&e.y===n)))return null;return c.find((e=>e.x===t+1&&e.y===n||e.x===t-1&&e.y===n||e.x===t&&e.y===n+1||e.x===t&&e.y===n-1))?{x:t,y:n,map:a.location.map}:null}),[c.length,t,n,r]);return d?(0,J.jsx)(i.Fragment,{children:(0,J.jsx)(gt,{onClick:()=>async function(e){try{await o({variables:{location:e,type:s}})}catch(t){}}(d),hover:!0,color:"rgb(10, 120, 10)",cellSize:e,boundingBox:l,location:d,tooltip:"Build here",icon:(0,J.jsx)(st.Z,{})},`${d.x}-${d.y}`)}):null}function pt({location:e,hero:t,onDestroy:n}){const[a,{loading:s}]=(0,z.Upb)(),[r,{loading:l}]=(0,z.bv4)(),[o,{loading:c}]=(0,z.xsR)(),[d,{loading:m}]=(0,z.nyX)(),[u,{loading:x}]=(0,z.SDN)(),g=(0,oe.mu)();return e.owner!==t.id?(0,J.jsx)(J.Fragment,{children:"Select a building that belongs to you."}):e.resources?(0,J.jsxs)(i.Fragment,{children:[(0,J.jsxs)("ul",{children:[(0,J.jsx)("li",{children:(0,J.jsx)(bt,{name:"Building type",value:e.type})}),e.resources.map((e=>e.value>0?(0,J.jsx)("li",{children:(0,J.jsx)(bt,{name:(0,ze.words)(e.name),"aria-label":`${e.value.toLocaleString()} out of ${(e.maximum??0).toLocaleString()}`,value:`${e.value.toLocaleString()} / ${(e.maximum??0).toLocaleString()}`})},e.name):null))]}),e.id===t.home?.id&&(0,J.jsx)(tt,{camp:e,hero:t}),e.type===z.Kt_.Settlement&&e.id!==t.home?.id&&(0,J.jsxs)(J.Fragment,{children:[(0,J.jsx)(h.Z,{children:"This settlement is a former capital that has fallen. You can destroy this location and reclaim most of the resources."}),(0,J.jsx)(Z.Z,{onClick:()=>n(e),variant:"contained",color:"error",children:"Destroy former settlement"})]}),e.type===z.Kt_.Barracks&&(0,J.jsx)(yt,{location:e,action:"Recruit",unit:"troops",cost:1e6,loading:s,onPurchase:e=>{a({variables:e})}}),e.type===z.Kt_.Treasury&&(0,J.jsx)(yt,{location:e,action:"Purchase",unit:"bonds",cost:1e6,loading:l,onPurchase:e=>{r({variables:e})}}),e.type===z.Kt_.Treasury&&(0,J.jsx)(yt,{location:e,action:"Sell",unit:"bonds",cost:1e6,loading:l,onPurchase:e=>{r({variables:{...e,amount:0-e.amount}})}}),e.type===z.Kt_.Treasury&&(0,J.jsxs)(J.Fragment,{children:[(0,J.jsx)(Qe.Z,{sx:{m:1},loading:x,variant:"contained",disabled:g,onClick:()=>{u({variables:{location:{x:e.location.x,y:e.location.y,map:e.location.map},greater:!1}})},children:"Craft Element of Gold (1,000,000 bonds)"}),(0,J.jsx)(Qe.Z,{sx:{m:1},loading:x,variant:"contained",disabled:g,onClick:()=>{u({variables:{location:{x:e.location.x,y:e.location.y,map:e.location.map},greater:!0}})},children:"Craft Greater Element of Gold (250,000,000 bonds)"})]}),e.type===z.Kt_.Garrison&&(0,J.jsx)(yt,{location:e,action:"Build",unit:"fortifications",cost:1e6,loading:m,onPurchase:e=>{d({variables:e})}})]}):null}function bt({name:e,value:t,"aria-label":n}){return(0,J.jsxs)(J.Fragment,{children:[(0,J.jsxs)("label",{style:{fontWeight:"bold"},htmlFor:`building-details-value-${e}`,children:[e,":"]})," ",(0,J.jsx)("span",{"aria-label":n,children:t})]})}function yt({location:e,action:t,unit:n,cost:a,loading:s=!1,onPurchase:r}){const[l,o]=(0,i.useState)(0),[c]=(0,z.Upb)(),d=(0,oe.mu)(),h=Number.isFinite(l)&&!isNaN(l)&&l>0;return(0,J.jsxs)(E.Z,{fullWidth:!0,children:[(0,J.jsx)(_.Z,{onChange:e=>o(parseInt(e.target.value)),id:`${t}-input`,label:`Amount of ${n} to ${t.toLowerCase()}`}),(0,J.jsxs)(Qe.Z,{loading:s,variant:"contained",disabled:!h||d,onClick:()=>{Number.isFinite(l)&&!isNaN(l)&&r({location:{x:e.location.x,y:e.location.y,map:e.location.map},amount:l})},children:[!h&&`${t} ${n}`,h&&`${t} ${l.toLocaleString()} ${n} for ${(l*a).toLocaleString()} gold`]})]})}var ft=n(89),Zt=n(6656),vt=n(8456);function wt({open:e,onClose:t,loading:n,attackResults:i,hero:a}){return(0,J.jsx)(D.Z,{open:e,onClose:t,children:(0,J.jsxs)(l.Z,{sx:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",bgcolor:"background.paper",padding:[2,4],minWidth:"320px",maxWidth:"580px",width:"80%",textAlign:"center"},"aria-labelledby":"attack-results-modal-title","aria-describedby":"modal-modal-description",children:[n&&(0,J.jsx)(vt.Z,{}),i&&(0,J.jsxs)(J.Fragment,{children:[i.target.owner===a.id&&(0,J.jsx)(h.Z,{id:"attack-results-modal-title",variant:"h5",component:"h2",children:"Your troops have claimed this location in your name, it now belongs to your settlement."}),i.target.owner!==a.id&&(0,J.jsxs)(J.Fragment,{children:[(0,J.jsxs)(h.Z,{id:"attack-results-modal-title",variant:"h5",component:"h2",children:["Attack results for ",i.target.location.x,","," ",i.target.location.y]}),(0,J.jsxs)(h.Z,{variant:"subtitle1",children:["Owner:"," ",(0,J.jsx)("strong",{children:i?.target?.publicOwner?.name??"Unknown"})]})]}),(0,J.jsx)("br",{}),(0,J.jsxs)(h.Z,{children:["You lost ",St(i.attackerCasualties)]}),(0,J.jsxs)(h.Z,{children:["Your opponent lost"," ",St(i.targetCasualties)]}),i.totalDamage>0&&(0,J.jsxs)(h.Z,{children:["Your troops dealt ",i.totalDamage.toLocaleString()," ","damage"]}),i.damage>0&&(0,J.jsxs)(h.Z,{children:["The target location received"," ",i.damage.toLocaleString()," damage",i.totalDamage>i.damage&&", the rest was absorbed by garrisons."]}),0===i.damage&&(0,J.jsx)(h.Z,{children:"All damage was absorbed by garrisons."})]})]})})}function St(e){const t=Object.keys(e).map((t=>{const n=e[t];return!!(n&&n>0)&&`${n.toLocaleString()} ${t}`})).filter((e=>!!e));return t.length?t.join(", "):"nothing"}function kt({location:e,capital:t,hero:n,resources:a,refetch:s}){const[r,l]=(0,i.useState)(0),[o,c]=(0,i.useState)(0),[d,u]=(0,i.useState)(0),[x,g]=(0,i.useState)(0),[j,p]=(0,i.useState)(!1),[b]=(0,z.cKO)(),[y,{data:f,loading:v}]=(0,z.tyB)(),w=e?.owner!==n.id,S=e?.resources?.find((e=>"enlisted"===e.name)),k=e?.resources?.find((e=>"soldier"===e.name)),C=e?.resources?.find((e=>"veteran"===e.name)),P=e?.resources?.find((e=>"ghost"===e.name)),A={};return a.forEach((e=>{A[e.name]=e})),(0,J.jsxs)(J.Fragment,{children:[(0,J.jsx)(wt,{open:j,onClose:()=>p(!1),attackResults:f?.attackLocation,loading:v,hero:n}),(0,J.jsx)(h.Z,{variant:"h4",children:"Military actions"}),(0,J.jsx)(h.Z,{variant:"body1",children:"Use this UI to move your tropps or attack adjacent empires. You can only attack buildings owned by other players which are adjacent to your own. If you deal enough damage then the building will be converted over to your control."}),(0,J.jsx)("br",{}),(0,J.jsxs)(h.Z,{variant:"h6",component:"h4",children:["Remaining attacks: ",t.remainingAttacks]}),(0,J.jsx)("br",{}),(0,J.jsx)(h.Z,{variant:"h5",children:"Current target"}),!e&&(0,J.jsx)(h.Z,{variant:"body1",children:"Select a target using the map."}),e&&(0,J.jsxs)("ul",{children:[(0,J.jsxs)("li",{children:[(0,J.jsx)("label",{style:{fontWeight:"bold"},htmlFor:"military-target-location",children:"Location:"})," ",(0,J.jsxs)("span",{id:"military-target-location",children:[e.location.x,", ",e.location.y]})]}),(0,J.jsxs)("li",{children:[(0,J.jsx)("label",{style:{fontWeight:"bold"},htmlFor:"military-target-type",children:"Type:"})," ",(0,J.jsx)("span",{id:"military-target-type",children:e.type})]}),(0,J.jsxs)("li",{children:[(0,J.jsx)("label",{style:{fontWeight:"bold"},htmlFor:"military-target-owner",children:"Owner:"})," ",(0,J.jsx)("span",{id:"military-target-owner",children:e.publicOwner?.name})]})]}),!e&&(0,J.jsxs)("ul",{children:[(0,J.jsxs)("li",{children:[(0,J.jsx)("label",{style:{fontWeight:"bold"},htmlFor:"military-unit-info-enlisted",children:"Enlisted:"})," ",(0,J.jsx)("span",{id:"military-target-enlisted",children:(A.enlisted?.value??0).toLocaleString()})]}),(0,J.jsxs)("li",{children:[(0,J.jsx)("label",{style:{fontWeight:"bold"},htmlFor:"military-unit-info-soldier",children:"Soldier:"})," ",(0,J.jsx)("span",{id:"military-target-soldier",children:(A.soldier?.value??0).toLocaleString()})]}),(0,J.jsxs)("li",{children:[(0,J.jsx)("label",{style:{fontWeight:"bold"},htmlFor:"military-unit-info-veteran",children:"Veteran:"})," ",(0,J.jsx)("span",{id:"military-target-veteran",children:(A.veteran?.value??0).toLocaleString()})]}),(A.ghost?.value??0)>0&&(0,J.jsxs)("li",{children:[(0,J.jsx)("label",{style:{fontWeight:"bold"},htmlFor:"military-unit-info-ghost",children:"Ghost:"})," ",(0,J.jsx)("span",{id:"military-target-ghost",children:(A.ghost?.value??0).toLocaleString()})]})]}),e&&(0,J.jsxs)(J.Fragment,{children:[(0,J.jsx)(h.Z,{variant:"h5",children:"Troups in this location"}),(0,J.jsxs)("ul",{children:[(S?.value??0)>0&&(0,J.jsxs)("li",{children:[(0,J.jsx)("label",{style:{fontWeight:"bold"},htmlFor:"military-unit-info-enlisted",children:"Enlisted:"})," ",(0,J.jsx)("span",{id:"military-target-enlisted",children:(S?.value??0).toLocaleString()})]}),(k?.value??0)>0&&(0,J.jsxs)("li",{children:[(0,J.jsx)("label",{style:{fontWeight:"bold"},htmlFor:"military-unit-info-soldier",children:"Soldier:"})," ",(0,J.jsx)("span",{id:"military-target-soldier",children:(k?.value??0).toLocaleString()})]}),(C?.value??0)>0&&(0,J.jsxs)("li",{children:[(0,J.jsx)("label",{style:{fontWeight:"bold"},htmlFor:"military-unit-info-veteran",children:"Veteran:"})," ",(0,J.jsx)("span",{id:"military-target-veteran",children:(C?.value??0).toLocaleString()})]}),(P?.value??0)>0&&(0,J.jsxs)("li",{children:[(0,J.jsx)("label",{style:{fontWeight:"bold"},htmlFor:"military-unit-info-ghost",children:"Ghost:"})," ",(0,J.jsx)("span",{id:"military-target-ghost",children:(P?.value??0).toLocaleString()})]})]}),(0,J.jsx)(h.Z,{mb:2,component:"h6",variant:"h5",children:"Troops to send"}),(0,J.jsxs)(m.ZP,{container:!0,columns:6,spacing:2,children:[(0,J.jsx)(Ct,{name:"enlisted",value:r,onChange:l,max:w?A.enlisted?.value??0:Math.min(A.enlisted?.value??0,(S?.maximum??0)-(S?.value??0))}),(0,J.jsx)(Ct,{name:"soldier",value:o,onChange:c,max:w?A.soldier?.value??0:Math.min(A.soldier?.value??0,(k?.maximum??0)-(k?.value??0))}),(0,J.jsx)(Ct,{name:"veteran",value:d,onChange:u,max:w?A.veteran?.value??0:Math.min(A.veteran?.value??0,(C?.maximum??0)-(C?.value??0))}),(0,J.jsx)(Ct,{name:"ghost",value:x,onChange:g,max:w?A.ghost?.value??0:Math.min(A.ghost?.value??0,(P?.maximum??0)-(P?.value??0))})]}),w&&(0,J.jsx)(Z.Z,{onClick:async function(){if(!e)return;const{data:t}=await y({variables:{target:{x:e.location.x,y:e.location.y,map:e.location.map},units:{enlisted:r,soldier:o,veteran:d,ghost:x}}});t?.attackLocation&&(p(!0),t.attackLocation.target.owner===n.id&&s())},children:"Attack target"}),!w&&(0,J.jsx)(Z.Z,{onClick:function(){e&&b({variables:{target:{x:e.location.x,y:e.location.y,map:e.location.map},units:{enlisted:r,soldier:o,veteran:d,ghost:x}}})},children:"Move troops"})]})]})}function Ct({name:e,onChange:t,value:n,max:i}){return 0===i?null:(0,J.jsxs)(J.Fragment,{children:[(0,J.jsx)(m.ZP,{item:!0,xs:1,children:(0,J.jsxs)("label",{id:`military-slider-${e}-label`,children:[(0,ze.words)(e),":"]})}),(0,J.jsx)(m.ZP,{item:!0,xs:3,children:(0,J.jsx)(E.Z,{fullWidth:!0,children:(0,J.jsx)(Zt.ZP,{value:n,onChange:(e,n)=>t(n),min:0,max:i,valueLabelDisplay:"auto",getAriaValueText:e=>e.toLocaleString(),"aria-labelledby":`military-slider-${e}-label`})})}),(0,J.jsx)(m.ZP,{item:!0,xs:2,children:(0,J.jsx)(E.Z,{fullWidth:!0,children:(0,J.jsx)(ft.Z,{value:n,size:"small",onChange:e=>t(""===e.target.value?0:Number(e.target.value)),onBlur:()=>{n<0?t(0):n>i&&t(i)},inputProps:{step:1,min:0,max:i,type:"number","aria-labelledby":"input-slider"}})})})]})}var Pt=n(947);function At({cellSize:e,x:t,y:n,boundingBox:i,onClick:a,adjacentTiles:s}){const r=s.find((e=>e.location.x===t&&e.location.y===n));return r?(0,J.jsx)(gt,{onClick:()=>a(r),hover:!0,cellSize:e,boundingBox:i,location:{x:t,y:n},tooltip:"Attack here",color:"rgb(140, 0, 0)",icon:(0,J.jsx)(Pt.Z,{})},`${t}-${n}`):null}const $t={[z.Kt_.Farm]:(0,J.jsx)(lt.Z,{}),[z.Kt_.Shrine]:(0,J.jsx)(at.Z,{}),[z.Kt_.Apiary]:(0,J.jsx)(ct.Z,{}),[z.Kt_.Garrison]:(0,J.jsx)(ue.Z,{}),[z.Kt_.Barracks]:(0,J.jsx)(ut.Z,{})};function Lt({hero:e,onClose:t}){const[n,{loading:a}]=(0,z.j9V)(),[s,r]=(0,i.useState)(null),[o,c]=(0,i.useState)(null),[u,x]=(0,i.useState)(null),{data:p,loading:b,refetch:y}=(0,z.Dpx)({pollInterval:6e4}),f=(0,he.Z)(),v=(0,it.Z)(f.breakpoints.up("sm")),P=(0,it.Z)(f.breakpoints.up("md")),A=(0,it.Z)(f.breakpoints.up("lg")),$=!v&&!P&&!A,L=v&&!P&&!A,I=v&&P&&!A,F=v&&P&&A,[M,E]=(0,i.useState)("info");if((0,i.useEffect)((()=>{!e.home&&t&&t()}),[e.home,t]),!e.home)return null;if(b)return null;if(!p)return null;const{settlementManager:q}=p,{capital:W,availableBuildings:B,availableUpgrades:D,range:T,adjacentTiles:G}=q,H=W,R=H.connections.find((e=>e.id===o))??G.find((e=>e.id===o))??null,N=function(...e){return e.reduce(((e,t)=>(t.forEach((t=>{let n=e.find((e=>e.name===t.name));n?(n.value=n.value+t.value,(n.maximum||t.maximum)&&(n.maximum=(n.maximum??0)+(t.maximum??0))):e.push({...t})})),e)),[])}(H.resources,...H.connections.map((e=>e.resources))),K=N.find((e=>"population"===e.name))?.value??0,Q=(N.find((e=>"food"===e.name))?.value,(_=[...H.connections,H].map((e=>e.location))).reduce(((e,t)=>(e.min.x=Math.min(e.min.x,t.x),e.min.y=Math.min(e.min.y,t.y),e.max.x=Math.max(e.max.x,t.x),e.max.y=Math.max(e.max.y,t.y),e)),{min:{map:_[0].map,x:127,y:96},max:{map:_[0].map,x:0,y:0}}));var _;const Y=Q.max.x-Q.min.x+5,O=Q.max.y-Q.min.y+5;let U=290;$||(L?U=f.breakpoints.values.sm-60:I?U=f.breakpoints.values.md/2-40:F&&(U=f.breakpoints.values.lg/2-80));const V=8*Math.round(Math.min(U/Y,U/O)/8);function ie(){r(null)}function ae(e){"destroy"===M?r(e):"info"!==M&&"military"!==M||function(e){c(e?.id??null)}(e)}const se={};return H.connections.forEach((e=>{e.location.x in se||(se[e.location.x]={}),se[e.location.x][e.location.y]=e})),(0,J.jsxs)(l.Z,{children:[(0,J.jsxs)(X.Z,{open:!!s,onClose:ie,"aria-labelledby":"destroy-building-title","aria-describedby":"destroy-building-description",children:[(0,J.jsx)(ee.Z,{id:"destroy-building-title",children:"Destroy Building?"}),(0,J.jsx)(te.Z,{children:s&&(0,J.jsxs)(Ke.Z,{id:"destroy-building-description",children:["Are you sure you want to destroy the ",s.type," at"," ",s.location.x,", ",s.location.y,"?"]})}),(0,J.jsxs)(ne.Z,{children:[(0,J.jsx)(Z.Z,{onClick:ie,color:"info",children:"Cancel"}),(0,J.jsx)(Qe.Z,{loading:a,onClick:async function(){if(s)try{await n({variables:{location:{x:s.location.x,y:s.location.y,map:s.location.map}}})}catch(e){}finally{r(null)}},color:"error",children:"Destroy"})]})]}),(0,J.jsx)(w.ZP,{value:M,children:(0,J.jsxs)(m.ZP,{container:!0,columns:6,spacing:1,children:[(0,J.jsx)(m.ZP,{item:!0,xs:6,children:(0,J.jsx)(h.Z,{variant:"h4",children:"Settlement Manager"})}),(0,J.jsx)(m.ZP,{item:!0,xs:6,sm:3,md:2,lg:1,children:(0,J.jsxs)(h.Z,{children:[(0,J.jsx)("b",{children:"Capital"}),": ",H.location.x,", ",H.location.y]})}),(0,J.jsx)(m.ZP,{item:!0,xs:6,sm:3,md:2,lg:1,children:(0,J.jsxs)(h.Z,{children:[(0,J.jsx)("b",{children:"Map tiles"}),":"," ",(H.connections.length+1).toLocaleString()]})}),(0,J.jsx)(m.ZP,{item:!0,xs:6,sm:3,md:2,lg:1,children:(0,J.jsxs)(h.Z,{children:[(0,J.jsx)("b",{children:"Range"}),": ",T.toLocaleString()]})}),[...N].sort(((e,t)=>t.value-e.value)).map((e=>"stone"===e.name||"wood"===e.name||"food"===e.name||"water"===e.name?e.value<2*K?(0,J.jsx)(m.ZP,{item:!0,xs:6,sm:3,md:2,lg:1,children:(0,J.jsxs)(h.Z,{color:"error",children:[(0,J.jsx)("b",{children:(0,ze.words)(e.name)}),":"," ",e.value.toLocaleString(),e.maximum&&` / ${e.maximum.toLocaleString()}`,H.upkeep[e.name]>0&&`(-${H.upkeep[e.name].toLocaleString()})`]})},e.name):(0,J.jsxs)(m.ZP,{item:!0,xs:6,sm:3,md:2,lg:1,children:[(0,J.jsx)("b",{children:(0,ze.words)(e.name)}),":"," ",e.value.toLocaleString(),e.maximum&&` / ${e.maximum.toLocaleString()}`," ",H.upkeep[e.name]>0&&`(-${H.upkeep[e.name].toLocaleString()})`]},e.name):(0,J.jsxs)(m.ZP,{item:!0,xs:6,sm:3,md:2,lg:1,children:[(0,J.jsx)("b",{children:(0,ze.words)(e.name)}),":"," ",e.value.toLocaleString(),e.maximum&&` / ${e.maximum.toLocaleString()}`]},e.name))),(0,J.jsx)(m.ZP,{item:!0,xs:6,children:(0,J.jsxs)(S.Z,{"aria-label":"navigation tabs",variant:"scrollable",textColor:"secondary",indicatorColor:"secondary",onChange:(e,t)=>{u&&x(null),E(t)},sx:{flexShrink:0,flexGrow:1},children:[(0,J.jsx)(d.Z,{icon:(0,J.jsx)(ht.Z,{}),label:"Building Details",value:"info",wrapped:!0}),(0,J.jsx)(d.Z,{icon:(0,J.jsx)(st.Z,{}),label:"Build Buildings",value:"build",wrapped:!0}),(0,J.jsx)(d.Z,{icon:(0,J.jsx)(dt.Z,{}),label:"Destroy Buildings",value:"destroy",wrapped:!0}),(0,J.jsx)(d.Z,{icon:(0,J.jsx)(rt.Z,{}),label:"Resource Market",value:"market",wrapped:!0}),(0,J.jsx)(d.Z,{icon:(0,J.jsx)(mt.Z,{}),label:"Military",value:"military",wrapped:!0})]})}),(0,J.jsx)(m.ZP,{item:!0,xs:6,md:3,lg:3,children:(0,J.jsxs)(l.Z,{sx:{position:"relative"},children:[(0,J.jsx)(h.Z,{variant:"h6",style:C.Z,children:"Buildings"}),(0,J.jsx)(qe,{location:H.location,minimapSize:[Y,O],cellSize:V,renderCell:({x:e,y:t})=>{let n,i=!1,a=!1;if(se[e]?.[t]?.type!==z.Kt_.Garrison&&se[e-1]?.[t+1]?.type!==z.Kt_.Garrison&&se[e+1]?.[t+1]?.type!==z.Kt_.Garrison&&se[e-1]?.[t]?.type!==z.Kt_.Garrison&&se[e+1]?.[t]?.type!==z.Kt_.Garrison&&se[e-1]?.[t-1]?.type!==z.Kt_.Garrison&&se[e+1]?.[t-1]?.type!==z.Kt_.Garrison&&se[e]?.[t+1]?.type!==z.Kt_.Garrison&&se[e]?.[t-1]?.type!==z.Kt_.Garrison&&se[e]?.[t+2]?.type!==z.Kt_.Garrison&&se[e]?.[t-2]?.type!==z.Kt_.Garrison&&se[e+2]?.[t]?.type!==z.Kt_.Garrison&&se[e-2]?.[t]?.type!==z.Kt_.Garrison||(i=!0),se[e]?.[t]?.type!==z.Kt_.Barracks&&se[e-1]?.[t+1]?.type!==z.Kt_.Barracks&&se[e+1]?.[t+1]?.type!==z.Kt_.Barracks&&se[e-1]?.[t]?.type!==z.Kt_.Barracks&&se[e+1]?.[t]?.type!==z.Kt_.Barracks&&se[e-1]?.[t-1]?.type!==z.Kt_.Barracks&&se[e+1]?.[t-1]?.type!==z.Kt_.Barracks&&se[e]?.[t+1]?.type!==z.Kt_.Barracks&&se[e]?.[t-1]?.type!==z.Kt_.Barracks&&se[e]?.[t+2]?.type!==z.Kt_.Barracks&&se[e]?.[t-2]?.type!==z.Kt_.Barracks&&se[e+2]?.[t]?.type!==z.Kt_.Barracks&&se[e-2]?.[t]?.type!==z.Kt_.Barracks||(a=!0),i?(n="blue",a&&(n="green")):a&&(n="rgb(180, 200, 0)"),e===H.location.x&&t===H.location.y)return(0,J.jsx)(gt,{onClick:()=>ae({...H,connections:[]}),cellSize:V,boundingBox:Q,location:H.location,tooltip:"Capital",bgcolor:n,icon:(0,J.jsx)(ot.Z,{})});if(se[e]&&se[e][t]){const i=se[e][t];return(0,J.jsx)(gt,{hover:"destroy"===M,onClick:()=>ae(i),cellSize:V,boundingBox:Q,location:i.location,tooltip:i.type,bgcolor:n,icon:$t[i.type]??(0,J.jsx)(at.Z,{})},i.id)}return u?(0,J.jsx)(jt,{x:e,y:t,type:u,cellSize:V,boundingBox:Q,capital:H,range:T}):"military"===M?(0,J.jsx)(At,{x:e,y:t,onClick:e=>ae(e),cellSize:V,boundingBox:Q,adjacentTiles:G}):null}})]})}),(0,J.jsxs)(m.ZP,{item:!0,xs:6,md:3,lg:3,children:[(0,J.jsxs)(k.Z,{value:"build",children:[(0,J.jsx)(h.Z,{variant:"h6",children:"Construct new buildings"}),(0,J.jsx)(h.Z,{variant:"subtitle2",sx:{mb:1},children:"Each building uses a map tile."}),(0,J.jsx)(Ce.Z,{alignItems:"start",children:B.map((e=>(0,J.jsxs)(g.Z,{sx:{mb:3},children:[(0,J.jsx)(Ne.Z,{title:e.name}),(0,J.jsxs)(j.Z,{children:[(0,J.jsx)(h.Z,{sx:{mb:1},children:e.description}),(0,J.jsx)(h.Z,{variant:"h6",children:"Cost to build"}),(0,J.jsx)("ul",{style:{margin:2},children:e.cost.map((e=>(0,J.jsx)(i.Fragment,{children:(0,J.jsxs)("li",{children:[(0,J.jsxs)("label",{style:{fontWeight:"bold"},htmlFor:`cost-value-${e.name}`,children:[(0,ze.words)(e.name),":"]})," ",(0,J.jsx)("span",{id:`cost-value-${e.name}`,children:e.value.toLocaleString()})]})},e.name)))})]}),(0,J.jsx)(Re.Z,{children:(0,J.jsx)(Z.Z,{onClick:()=>x(e.type),variant:"contained",color:"success",children:"Build Building"},e.type)})]},e.name)))})]}),(0,J.jsx)(k.Z,{value:"destroy",children:"Click on a location to demolish the building there. You will get nothing back, and this cannot be undone."}),(0,J.jsx)(k.Z,{value:"market",children:(0,J.jsx)(Oe,{hero:e,camp:H,onBuyResource:function(){y()}})}),(0,J.jsxs)(k.Z,{value:"info",children:[(0,J.jsx)(h.Z,{variant:"h5",children:"Building Details"}),!R&&(0,J.jsx)(h.Z,{variant:"body1",children:"Select a building from the map on the left to see details about it here."}),R&&(0,J.jsx)(pt,{location:R,hero:e,onDestroy:r}),!R&&(0,J.jsx)(pt,{location:H,hero:e,onDestroy:r})]}),(0,J.jsx)(k.Z,{value:"military",children:(0,J.jsx)(kt,{location:R,capital:H,resources:N,hero:e,refetch:y})})]})]})})]})}function It(){const[e,t]=i.useState(""),[n,a]=(0,oe.gZ)(),[s,{loading:r}]=(0,z.bt)(),l=r||n>0,o=n>0?`In delay: available in ${(n/1e3).toFixed(1)}s`:r?"Asking...":"";return(0,J.jsxs)("div",{children:[(0,J.jsx)(B.Z,{title:n>0?`In delay: available in ${(n/1e3).toFixed(1)}s`:r?"Talking to the bartender...":"Ask the bartender for advice",disableHoverListener:!(n>0||r),children:(0,J.jsx)("span",{children:(0,J.jsx)(Z.Z,{variant:"contained",color:"secondary",onClick:async function(){try{const e=(await s()).data?.talk?.message??"";t(e)}catch(e){e.graphQLErrors&&e.graphQLErrors[0]?.extensions?.delay&&a(e.graphQLErrors[0].extensions.remaining)}},disabled:l,children:"Ask Bartender about Gossip"})})}),o&&(0,J.jsx)(h.Z,{variant:"caption",color:"text.secondary",display:"block",sx:{mt:1},children:o}),e&&(0,J.jsx)(h.Z,{component:"div",variant:"body1",sx:{mt:2,whiteSpace:"pre-line"},children:e})]})}function Ft(){const[e,t]=(0,oe.gZ)(),{data:n,refetch:a}=(0,z.q75)({fetchPolicy:"cache-and-network"}),s=!!n?.graalAvailable,{data:r,refetch:o}=(0,z.zNH)({skip:!s,fetchPolicy:"cache-and-network"}),[c,{loading:d}]=(0,z.hE$)(),[m,{loading:u}]=(0,z.m8V)(),[x,g]=i.useState(null),[j,p]=i.useState(null),[b,y]=i.useState(null),[f,v]=i.useState(!1),[w,S]=i.useState(!1),k=d||u||e>0||!s,C=s?e>0?`In delay: available in ${(e/1e3).toFixed(1)}s`:d?"Fighting Graal...":u?"Applying boon...":"":"You may only challenge once per day.";async function P(e){try{await m({variables:{benefit:e}}),S(!1),await o()}catch(n){n.graphQLErrors&&n.graphQLErrors[0]?.extensions?.delay&&t(n.graphQLErrors[0].extensions.remaining)}}return n?(0,J.jsxs)("div",{children:[(0,J.jsx)(h.Z,{variant:"h6",component:"h3",gutterBottom:!0,children:"Dueling Stone"}),(0,J.jsx)(B.Z,{title:C,disableHoverListener:!k,children:(0,J.jsx)("span",{children:(0,J.jsx)(Z.Z,{variant:"outlined",color:"secondary",disabled:k,onClick:async function(){try{const e=(await c()).data?.challengeGraal;e&&(g(e.outcome),p(e.hint??null),y(e.log??null),v(!0),S("loss"===e.outcome)),await Promise.all([o(),a()])}catch(e){e.graphQLErrors&&e.graphQLErrors[0]?.extensions?.delay&&t(e.graphQLErrors[0].extensions.remaining)}},children:"Challenge Graal"})})}),x&&(0,J.jsxs)(l.Z,{sx:{mt:1},children:[(0,J.jsxs)(h.Z,{variant:"subtitle2",color:"text.secondary",children:["Outcome: ",x]}),j&&(0,J.jsx)(h.Z,{variant:"body2",sx:{whiteSpace:"pre-line"},children:j}),b&&b.length>0&&(0,J.jsxs)(l.Z,{sx:{mt:1},children:[(0,J.jsx)(Z.Z,{size:"small",onClick:()=>v((e=>!e)),children:f?"Hide duel log":"Show duel log"}),f&&(0,J.jsx)(l.Z,{sx:{mt:1,maxHeight:200,overflowY:"auto",textAlign:"left"},children:b.slice(0,100).map(((e,t)=>(0,J.jsxs)(h.Z,{variant:"caption",display:"block",children:["t=",e.time," \u2022 ",e.from," \u2192 ",e.to,": -",Math.round(e.damage)," ",e.isEnchantment?"[ench]":""," ",e.critical?"[crit]":""]},`gll-${t}`)))})]})]}),w&&(0,J.jsxs)(l.Z,{sx:{mt:1},children:[(0,J.jsx)(h.Z,{variant:"body2",gutterBottom:!0,children:"Choose your tempering:"}),(0,J.jsx)(Z.Z,{size:"small",sx:{mr:1},onClick:()=>P(z.jH$.ShameForged),children:"Shame-Forged (+1% boss damage \xd710 kills)"}),(0,J.jsx)(Z.Z,{size:"small",onClick:()=>P(z.jH$.Scabsteel),children:"Scabsteel (+2% defense, 1h)"})]}),r?.graalLedger&&(0,J.jsx)(l.Z,{sx:{mt:1},children:(0,J.jsxs)(h.Z,{variant:"caption",color:"text.secondary",display:"block",children:["Duels: ",r.graalLedger.total," \u2014 W ",r.graalLedger.wins," / L ",r.graalLedger.losses," \u2014 Streak ",r.graalLedger.currentStreak," (Best ",r.graalLedger.bestStreak,")"]})})]}):null}const Mt={"random-aberration-unholy-paladin":"The darkness here isn't natural","random-aberration-thornbrute":"The overgrowth here is hostile and deadly","domari-aberration-1":"The ash in the air is so thick you can barely breathe","random-aberration-moving-mountain":"The ground itself threatens you","random-aberration-artificer":"Ancient machinery whirs and clicks around you, filling the air with an otherworldly hum"};function Et(){const e=R(),[t,n]=(0,i.useState)(!1),[a,s]=(0,i.useState)(-1),[r,c]=(0,i.useState)(-1),[d,u]=(0,oe.gZ)(),[x,{loading:g}]=(0,z.gKg)(),[j,{loading:p}]=(0,z.Q8L)(),{data:b,refetch:y}=(0,z.OfX)(),f=b?.monsters?.map?.((e=>Mt[e.monster.id]??""))??[],v=ce(),w=de(),S=function(){const e=ce()?.playerLocations||[];return e.length?e[0]:null}(),k=v?.neighborTerrain.north?v.neighborTerrain.north.terrain:"blocked",C=v?.neighborTerrain.south?v.neighborTerrain.south.terrain:"blocked",P=v?.neighborTerrain.east?v.neighborTerrain.east.terrain:"blocked",A=v?.neighborTerrain.west?v.neighborTerrain.west.terrain:"blocked";if((0,i.useEffect)((()=>{e&&(s(e.location.x),c(e.location.y))}),[e]),!e)return null;if(t)return(0,J.jsx)(Lt,{hero:e});const $=g||0===e.combat.health||d>0||p||!!e.dungeon?.lockedLocation,L=(()=>{if(e.dungeon?.lockedLocation){const t=e.dungeon.lockedLocation;return`Movement locked at ${t.x}, ${t.y} (${t.map})`}return 0===e.combat.health?"You are dead. Heal in the Combat tab.":d>0?`In delay: available in ${(d/1e3).toFixed(1)}s`:g?"Moving...":p?"Teleporting...":""})();async function I(e){try{await x({variables:{direction:e}}),y()}catch(t){t.graphQLErrors&&t.graphQLErrors[0]?.extensions?.delay&&u(t.graphQLErrors[0].extensions.remaining)}}function F(e,t){let n=Number(e),i=Number(t);!isNaN(n)&&!isNaN(i)&&Number.isFinite(n)&&Number.isFinite(i)&&(i=Math.min(95,Math.max(0,Math.round(i))),n=Math.min(127,Math.max(0,Math.round(n))),n!==a&&s(n),i!==r&&c(i))}const M=Math.round(Math.pow(5*(0,N.LW)(e.location,{x:a,y:r}),1.3));return(0,J.jsx)(i.Fragment,{children:(0,J.jsxs)(m.ZP,{container:!0,columns:2,spacing:3,children:[(0,J.jsx)(m.ZP,{item:!0,xs:2,sm:1,children:(0,J.jsxs)(m.ZP,{container:!0,columns:6,spacing:3,children:[(0,J.jsx)(m.ZP,{item:!0,style:{textAlign:"center"},xs:6,children:(0,J.jsx)(Ue,{hero:e,onShowSettlement:function(){n(!0)}})}),(0,J.jsxs)(m.ZP,{item:!0,style:{textAlign:"center"},xs:6,children:[(0,J.jsx)(h.Z,{variant:"h3",children:"Travel"}),e.combat.health>0&&(0,J.jsx)(h.Z,{children:e.dungeon?.lockedLocation?`Movement locked at ${e.dungeon.lockedLocation.x}, ${e.dungeon.lockedLocation.y} (${e.dungeon.lockedLocation.map}).`:"Use buttons to move around the map."}),0===e.combat.health&&(0,J.jsx)(h.Z,{component:"p",variant:"h6",children:"You cannot move while dead. Heal yourself in the Combat tab."})]}),(0,J.jsx)(m.ZP,{item:!0,style:{textAlign:"center"},xs:6,children:L&&(0,J.jsx)(h.Z,{variant:"caption",color:"text.secondary",children:L})}),(0,J.jsx)(m.ZP,{item:!0,style:{textAlign:"center"},xs:2}),(0,J.jsx)(m.ZP,{item:!0,style:{textAlign:"center"},xs:2,children:(0,J.jsx)(Z.Z,{"aria-label":`North terrain: ${k}`,disabled:$,variant:"contained",onClick:()=>I(z.p$b.North),startIcon:(0,J.jsx)(Le.Z,{}),children:"North"})}),(0,J.jsx)(m.ZP,{item:!0,style:{textAlign:"center"},xs:2}),(0,J.jsx)(m.ZP,{item:!0,style:{textAlign:"center"},xs:2,children:(0,J.jsx)(Z.Z,{"aria-label":`West terrain: ${A}`,disabled:$,variant:"contained",onClick:()=>I(z.p$b.West),startIcon:(0,J.jsx)(Fe.Z,{}),children:"West"})}),(0,J.jsx)(m.ZP,{item:!0,style:{textAlign:"center"},xs:2,children:(0,J.jsxs)(h.Z,{children:[e.location.x,", ",e.location.y]})}),(0,J.jsx)(m.ZP,{item:!0,style:{textAlign:"center"},xs:2,children:(0,J.jsx)(Z.Z,{"aria-label":`East terrain: ${P}`,disabled:$,variant:"contained",onClick:()=>I(z.p$b.East),startIcon:(0,J.jsx)(Me.Z,{}),children:"East"})}),(0,J.jsx)(m.ZP,{item:!0,style:{textAlign:"center"},xs:2}),(0,J.jsx)(m.ZP,{item:!0,style:{textAlign:"center"},xs:2,children:(0,J.jsx)(Z.Z,{"aria-label":`South terrain: ${C}`,disabled:$,variant:"contained",onClick:()=>I(z.p$b.South),startIcon:(0,J.jsx)(Ie.Z,{}),children:"South"})}),(0,J.jsx)(m.ZP,{item:!0,style:{textAlign:"center"},xs:2}),e.stats.intelligence>100&&(0,J.jsxs)(m.ZP,{item:!0,style:{textAlign:"center"},xs:6,children:[(0,J.jsx)(o.Z,{}),(0,J.jsx)(h.Z,{variant:"h5",component:"h3",color:"secondary",sx:{margin:1},children:"Teleport"}),(0,J.jsx)(_.Z,{label:"X coordinate",value:a,onChange:e=>F(e.target.value,r),sx:{width:"100px",margin:1}}),(0,J.jsx)(_.Z,{label:"Y coordinate",value:r,onChange:e=>F(a,e.target.value),sx:{width:"100px",margin:1}}),(0,J.jsx)("br",{}),(0,J.jsx)(l.Z,{sx:{my:1},children:(0,J.jsxs)(h.Z,{variant:"caption",color:M>e.stats.intelligence?"error":"text.secondary",children:["Cost: ",M.toLocaleString()," INT; You have"," ",e.stats.intelligence.toLocaleString()," INT"]})}),(0,J.jsx)(B.Z,{title:e.dungeon?.lockedLocation?"Cannot teleport while in a locked dungeon":0===M?"Already at target coordinates":M>e.stats.intelligence?"Insufficient intelligence":d>0?`In delay: available in ${(d/1e3).toFixed(1)}s`:0===e.combat.health?"Cannot teleport while dead":$?"Action temporarily unavailable":"Teleport to target coordinates",disableHoverListener:!(e.dungeon?.lockedLocation||0===M||M>e.stats.intelligence||$),children:(0,J.jsx)("span",{children:(0,J.jsx)(Z.Z,{color:"secondary",variant:"outlined",onClick:async function(){try{await j({variables:{x:a,y:r}}),y()}catch(e){e.graphQLErrors&&e.graphQLErrors[0]?.extensions?.delay&&u(e.graphQLErrors[0].extensions.remaining)}},disabled:!!e.dungeon?.lockedLocation||0===M||M>e.stats.intelligence||$,children:"Teleport"})})})]})]})}),(0,J.jsxs)(m.ZP,{item:!0,style:{textAlign:"center"},xs:2,sm:1,children:[w&&(0,J.jsx)(h.Z,{variant:"h6",component:"h4",children:w.name}),w&&(0,J.jsx)(h.Z,{variant:"subtitle2",component:"p",children:w.type}),S&&(0,J.jsxs)(i.Fragment,{children:[(0,J.jsxs)(h.Z,{variant:"h6",component:"h4",children:[S.publicOwner?.name??"???","'s Settlement"]}),(0,J.jsx)(h.Z,{variant:"subtitle2",component:"p",children:S.type})]}),!w&&!S&&v&&(0,J.jsxs)(i.Fragment,{children:[(0,J.jsx)(h.Z,{variant:"h6",component:"h4",children:"Wilderness"}),(0,J.jsx)(h.Z,{variant:"subtitle2",component:"p",children:v.terrain.terrain})]}),!w&&!S&&!v&&(0,J.jsxs)(i.Fragment,{children:[(0,J.jsx)(h.Z,{variant:"h6",component:"h4",children:"\xa0"}),(0,J.jsx)(h.Z,{variant:"subtitle2",component:"p",children:"loading..."})]}),(0,J.jsx)(qe,{location:e.location,renderCell:({x:t,y:n})=>e.location.x===t&&e.location.y===n?(0,J.jsx)("div",{style:{borderRadius:"4px",backgroundColor:"red",border:"2px solid rgba(255,255,255,0.3)",width:"8px",height:"8px",margin:"auto"}}):null}),w?.description&&w.description.map(((e,t)=>(0,J.jsx)(h.Z,{component:"h4",variant:"body1",children:e},`loc-desc-${t}`))),f.filter((e=>!!e)).map((e=>(0,J.jsx)(h.Z,{component:"h4",variant:"body1",children:e},e)))]}),"dock"===w?.type&&(0,J.jsx)(m.ZP,{item:!0,style:{textAlign:"center"},xs:2,children:(0,J.jsx)(We,{location:w})}),"tavern"===w?.type&&e.questLog.tasteForBusiness?.finished&&(0,J.jsx)(m.ZP,{item:!0,style:{textAlign:"center"},xs:2,children:(0,J.jsx)(It,{})}),"tavern"===w?.type&&e.level>1e3&&(0,J.jsx)(m.ZP,{item:!0,style:{textAlign:"center"},xs:2,children:(0,J.jsx)(Ft,{})}),v?.shop&&(0,J.jsx)(m.ZP,{item:!0,style:{textAlign:"center"},xs:2,children:(0,J.jsx)(De,{shop:v?.shop})})]})})}var qt=n(5582);function Wt(){const[e,t]=(0,oe.gZ)();let[n,a]=(0,i.useState)(1);const[s,{loading:r}]=(0,z.Y46)(),c=R();c?.attributePoints&&(n=Math.min(n,c.attributePoints));const d=`Spending ${n.toLocaleString()} attribute points`;async function u(e){console.log("Leveling up...",e);try{await s({variables:{attribute:z.GCP[e],amount:n}})}catch(i){i.graphQLErrors&&i.graphQLErrors[0]?.extensions?.delay&&t(i.graphQLErrors[0].extensions.remaining)}}return(0,J.jsxs)(i.Fragment,{children:[(0,J.jsxs)(l.Z,{sx:{backgroundColor:"secondary.light"},children:[(0,J.jsx)("br",{}),(0,J.jsx)(h.Z,{variant:"h5",align:"center",children:"You have leveled up!"}),(0,J.jsxs)(qt.Z,{children:[(0,J.jsx)(h.Z,{align:"center",children:"Each of your attributes increases by 1 when you level up. You may also choose an attribute to further increase."}),(0,J.jsx)(l.Z,{sx:{textAlign:"center",align:"center",ml:1,mr:1},children:c&&c.attributePoints>2&&(0,J.jsxs)(i.Fragment,{children:[(0,J.jsx)(h.Z,{id:"level-up-stat-slider-label",children:d}),(0,J.jsx)(Zt.ZP,{min:1,max:c.attributePoints,value:n,onChange:(e,t)=>!Array.isArray(t)&&a(t),id:"level-up-stat-slider","aria-labelledby":"level-up-stat-slider-label",valueLabelDisplay:"auto"})]})})]}),(0,J.jsx)("br",{}),(0,J.jsxs)(m.ZP,{container:!0,columns:14,spacing:2,children:[(0,J.jsx)(B.Z,{title:"Strength determines your damage when attacking with melee weapons",children:(0,J.jsx)(m.ZP,{item:!0,xs:14,sm:7,md:4,lg:2,children:(0,J.jsx)(h.Z,{align:"center",children:(0,J.jsx)(Z.Z,{id:"level-up-strength",disabled:r||e>0,onClick:()=>u("Strength"),variant:"contained",children:"Strength"})})})}),(0,J.jsx)(B.Z,{title:"Dexterity determines the accuracy and dodge rate for melee and ranged weapons, it also determines ranged weapons damage",children:(0,J.jsx)(m.ZP,{item:!0,xs:14,sm:7,md:4,lg:2,children:(0,J.jsx)(h.Z,{align:"center",children:(0,J.jsx)(Z.Z,{id:"level-up-dexterity",disabled:r||e>0,onClick:()=>u("Dexterity"),variant:"contained",children:"Dexterity"})})})}),(0,J.jsx)(B.Z,{title:"Constitution determines your max health, and is used in both attacking and defending blood magic",children:(0,J.jsx)(m.ZP,{item:!0,xs:14,sm:7,md:4,lg:2,children:(0,J.jsx)(h.Z,{align:"center",children:(0,J.jsx)(Z.Z,{id:"level-up-constitution",disabled:r||e>0,onClick:()=>u("Constitution"),variant:"contained",children:"Constitution"})})})}),(0,J.jsx)(B.Z,{title:"Intelligence determines your spellcasting damage",children:(0,J.jsx)(m.ZP,{item:!0,xs:14,sm:7,md:4,lg:2,children:(0,J.jsx)(h.Z,{align:"center",children:(0,J.jsx)(Z.Z,{id:"level-up-intelligence",disabled:r||e>0,onClick:()=>u("Intelligence"),variant:"contained",children:"Intelligence"})})})}),(0,J.jsx)(B.Z,{title:"Wisdom is your accuracy and dodge stat for spellcasting and smiting",children:(0,J.jsx)(m.ZP,{item:!0,xs:14,sm:7,md:4,lg:2,children:(0,J.jsx)(h.Z,{align:"center",children:(0,J.jsx)(Z.Z,{id:"level-up-wisdom",disabled:r||e>0,onClick:()=>u("Wisdom"),variant:"contained",children:"Wisdom"})})})}),(0,J.jsx)(B.Z,{title:"Willpower helps you survive attacks by reducing damage, it also helps smiters deal deal more damage.",children:(0,J.jsx)(m.ZP,{item:!0,xs:14,sm:7,md:4,lg:2,children:(0,J.jsx)(h.Z,{align:"center",children:(0,J.jsx)(Z.Z,{id:"level-up-willpower",disabled:r||e>0,onClick:()=>u("Willpower"),variant:"contained",children:"Willpower"})})})}),(0,J.jsx)(B.Z,{title:"Luck helps you critically strike foes and also affects item drop rates",children:(0,J.jsx)(m.ZP,{item:!0,xs:14,md:12,lg:2,children:(0,J.jsx)(h.Z,{align:"center",children:(0,J.jsx)(Z.Z,{id:"level-up-luck",disabled:r||e>0,onClick:()=>u("Luck"),variant:"contained",children:"Luck"})})})}),(0,J.jsx)(B.Z,{title:"Places 1 in every stat for a more well rounded character",children:(0,J.jsx)(m.ZP,{item:!0,xs:14,md:12,lg:2,children:(0,J.jsx)(h.Z,{align:"center",children:(0,J.jsx)(Z.Z,{id:"level-up-all",disabled:r||e>0,onClick:()=>u("All"),variant:"contained",children:"All"})})})})]}),(0,J.jsx)("br",{}),(0,J.jsx)("br",{}),(0,J.jsx)("br",{})]}),(0,J.jsx)(o.Z,{})]})}const Bt={[z.$7w.MeleeWeapon]:"Melee Weapon",[z.$7w.RangedWeapon]:"Ranged Weapon",[z.$7w.SpellFocus]:"Spell Focus",[z.$7w.Shield]:"Shield",[z.$7w.BodyArmor]:"Body Armor",[z.$7w.HandArmor]:"Gauntlets",[z.$7w.LegArmor]:"Leggings",[z.$7w.HeadArmor]:"Helmet",[z.$7w.FootArmor]:"Greaves"};function Dt(e){return Bt[e]??(0,N.qh)(e)}function Tt({value:e,onChange:t,sellables:n}){const a=R();if(!a)return null;function s(e){const t="string"===typeof e?e:e.baseItem,i=n.find((e=>e.id===t));return i&&i.cost?{...i,cost:Math.round(i.cost/3)}:null}const r=a.inventory.filter((e=>!e.enchantment)).filter((e=>e.type!==z.$7w.Quest)).sort(((e,t)=>e.level-t.level)),l="Sell non-enchanted gear";return(0,J.jsx)(i.Fragment,{children:(0,J.jsxs)(E.Z,{fullWidth:!0,children:[(0,J.jsx)(q.Z,{id:"sell-shop-select-label",children:l}),(0,J.jsx)(K.Z,{id:"sell-shop-select",labelId:"sell-shop-select-label",value:e||"",label:l,onChange:e=>{const n=e.target.value,i=a.inventory.find((e=>e.id===n));if(!i)return;const r=s(i);r&&r.cost&&t&&t({id:n,name:(0,N.GJ)(i),cost:r.cost})},children:r.map((e=>{const t=s(e),n=(e.builtIns||[]).length>0;return(0,J.jsxs)(Q.Z,{value:e.id,disabled:!t||!!e.enchantment||(0,N.mQ)(a,e),children:[t?.cost&&(0,J.jsxs)(J.Fragment,{children:[(0,J.jsxs)(h.Z,{display:"inline-block",children:[n&&(0,J.jsx)("span",{style:C.Z,children:"(Superior base) "}),(0,N.GJ)(e)]}),"\xa0",(0,J.jsxs)(h.Z,{variant:"caption",display:"inline-block",children:["Lvl. ",e.level]}),"\xa0",(0,J.jsxs)(h.Z,{variant:"subtitle2",display:"inline-block",sx:{color:"info.main"},children:[t.cost.toLocaleString()," Gold"]})]}),!t?.cost&&e.name," ",(0,N.mQ)(a,e)&&"*EQUIPPED*"]},e.id)}))})]})})}function Gt({type:e,items:t,value:n,onChange:i}){const a=R(),s=`${Dt(e)} Shop`;return a?(0,J.jsxs)(E.Z,{fullWidth:!0,children:[(0,J.jsx)(q.Z,{id:`${e}-shop-select-label`,children:s}),(0,J.jsx)(K.Z,{id:`${e}-shop-select`,labelId:`${e}-shop-select-label`,value:n||"",label:s,onChange:e=>{const n=e.target.value,a=t.find((e=>e.id===n));i&&a&&a.cost&&i({id:n,name:a.name,cost:a.cost})},children:t.map((e=>e.id!==e.alias?null:(0,J.jsxs)(Q.Z,{value:e.id,disabled:!e.cost||e.cost>a.gold,children:[e.cost&&(0,J.jsxs)(J.Fragment,{children:[(0,J.jsx)(h.Z,{display:"inline-block",children:e.name}),"\xa0",(0,J.jsxs)(h.Z,{variant:"caption",display:"inline-block",children:["Lvl. ",e.level]}),"\xa0",(0,J.jsxs)(h.Z,{variant:"subtitle2",display:"inline-block",sx:{color:"info.main"},children:[e.cost.toLocaleString()," Gold"]})]}),!e.cost&&e.name]},e.id)))})]}):null}function Ht(){const[e]=(0,oe.gZ)(),[t,n]=(0,i.useState)(null),[a,s]=(0,i.useState)(""),{data:r,loading:l,error:c}=(0,z.CbY)(),[d,{loading:u}]=(0,z.Nn4)(),[x,{loading:g}]=(0,z.o_Z)(),j=g||u||e>0;const p="Choose which shop to visit";return(0,J.jsxs)(i.Fragment,{children:[(0,J.jsxs)(h.Z,{align:"center",children:["Welcome to the shop! You can buy and sell any non-enchanted items here.",(0,J.jsx)("br",{}),"The items purchasable here have a level from 1 to 32 but no enchantments or direct attribute increases."]}),(0,J.jsx)("br",{}),(0,J.jsx)(o.Z,{}),(0,J.jsx)("br",{}),(0,J.jsxs)(m.ZP,{container:!0,columns:6,spacing:2,children:[(0,J.jsx)(m.ZP,{item:!0,xs:6,sm:3,children:(0,J.jsxs)(E.Z,{fullWidth:!0,children:[(0,J.jsx)(q.Z,{id:"shop-type-select-label",children:p}),(0,J.jsxs)(K.Z,{id:"shop-type-select",labelId:"shop-type-select-label",label:p,onChange:e=>{s(e.target.value),n(null)},children:[(0,J.jsx)(Q.Z,{value:"sell",children:"Sell Items"}),(0,J.jsx)(o.Z,{}),(0,J.jsxs)(Q.Z,{value:z.$7w.MeleeWeapon,children:[Dt(z.$7w.MeleeWeapon)," Shop"]}),(0,J.jsxs)(Q.Z,{value:z.$7w.RangedWeapon,children:[Dt(z.$7w.RangedWeapon)," Shop"]}),(0,J.jsxs)(Q.Z,{value:z.$7w.SpellFocus,children:[Dt(z.$7w.SpellFocus)," Shop"]}),(0,J.jsxs)(Q.Z,{value:z.$7w.Shield,children:[Dt(z.$7w.Shield)," Shop"]}),(0,J.jsxs)(Q.Z,{value:z.$7w.BodyArmor,children:[Dt(z.$7w.BodyArmor)," Shop"]}),(0,J.jsxs)(Q.Z,{value:z.$7w.HandArmor,children:[Dt(z.$7w.HandArmor)," Shop"]}),(0,J.jsxs)(Q.Z,{value:z.$7w.LegArmor,children:[Dt(z.$7w.LegArmor)," Shop"]}),(0,J.jsxs)(Q.Z,{value:z.$7w.HeadArmor,children:[Dt(z.$7w.HeadArmor)," Shop"]}),(0,J.jsxs)(Q.Z,{value:z.$7w.FootArmor,children:[Dt(z.$7w.FootArmor)," Shop"]})]})]})}),(0,J.jsxs)(m.ZP,{item:!0,xs:6,sm:3,children:[""!==a&&"sell"!==a&&(0,J.jsx)(Gt,{value:t?t.id:"",type:a,items:(b=a,r?.shopItems?.length?r.shopItems.filter((e=>e.type===b)):[]),onChange:e=>n(e)},a),"sell"===a&&(0,J.jsx)(Tt,{value:t?t.id:"",sellables:r?.shopItems??[],onChange:e=>n(e)})]}),(0,J.jsx)(m.ZP,{item:!0,xs:6,children:t&&(0,J.jsxs)(Z.Z,{variant:"contained",color:"sell"===a?"error":"success",fullWidth:!0,disabled:j,onClick:"sell"===a?async function(){if(t)try{n(null),await x({variables:{item:t.id}})}catch(e){}}:async function(){if(t)try{n(null),await d({variables:{baseItem:t.id}})}catch(e){}},children:["sell"===a?"Sell":"Buy"," ",t.name," for"," ",t.cost.toLocaleString()," gold"]})})]}),(0,J.jsx)("br",{})]});var b}function zt(){R();const e=ce();de();return(0,J.jsxs)(i.Fragment,{children:[(0,J.jsx)(h.Z,{variant:"h3",sx:{textAlign:"center"},children:"Item Shop"}),(0,J.jsx)(Ht,{}),e?.shop&&(0,J.jsx)(De,{shop:e?.shop})]})}function Rt({title:e,builtIns:t,sx:n}){return t&&t.length&&e?(0,J.jsxs)(i.Fragment,{children:[(0,J.jsx)(h.Z,{children:e}),t.map((e=>(0,J.jsx)(h.Z,{variant:"body1",sx:n,children:(0,J.jsx)("b",{children:(0,N.xq)(e)})},e.type)))]}):null}function Nt({hero:e,disabled:t}){const[n,{loading:a}]=(0,z.Nwq)(),s=e.level>=e.levelCap;return(0,J.jsxs)(l.Z,{sx:{padding:1,margin:1},children:[(0,J.jsx)(h.Z,{color:"secondary",variant:"h2",children:"Rebirth"}),!s&&(0,J.jsx)(h.Z,{children:"You may only be reborn when you are at level cap. Keep leveling up your character in order to be reborn!"}),s&&(0,J.jsxs)(i.Fragment,{children:[(0,J.jsx)(h.Z,{children:"This will reset your character's level and attributes, however you will keep all gold and items and will receive special bonuses depending on your current level cap."}),(0,J.jsx)("br",{}),(0,J.jsx)(Z.Z,{size:"large",variant:"outlined",color:"secondary",onClick:async function(){try{await n()}catch(e){console.log(e)}},"data-testid":"rebirth-button",children:"Reset Character to Level 1"})]})]})}var Kt=n(5988),Qt=n(9629);function _t({hero:e,disabled:t}){let[n,a]=(0,i.useState)(""),[s,r]=(0,i.useState)("");const l=!!e.inventory.find((e=>(0,N.kJ)(e.baseItem))),[o,{loading:c}]=(0,z.PwK)(),d=e.inventory.filter((t=>t.type!==z.$7w.Quest&&(!(0,N.mQ)(e,t)&&!!t.enchantment))),m=d.filter((e=>""===s||e.enchantment===s)).sort(N.v4),u=d.filter((t=>!(0,N.mQ)(e,t))).map((e=>e.enchantment)).reduce(((e,t)=>t?(e.indexOf(t)<0&&e.push(t),e):e),[]),x="Select item to destroy";let g=m.find((e=>e.id===n));return!g&&n.length&&(m.length?(g=m[0],n=g.id):n=""),(0,J.jsxs)(i.Fragment,{children:[(0,J.jsx)(h.Z,{variant:"body1",children:"Select an enchanted item you would like to destroy, smashing it with the crafting hammer into fine Enchanting Dust."}),(0,J.jsx)("br",{}),(0,J.jsxs)(E.Z,{fullWidth:!0,children:[(0,J.jsx)(q.Z,{id:"destroy-select-label",children:x}),(0,J.jsx)(K.Z,{id:"destroy-select",labelId:"destroy-select-label",value:n||"",label:x,onChange:t=>{const n=t.target.value;e.inventory.find((e=>e.id===n))&&a(n)},children:m.map((t=>{const n=(t.builtIns||[]).length>0,i=(t.builtIns||[]).map((e=>(0,N.xq)(e))).join(", ");return(0,J.jsxs)(Q.Z,{value:t.id,disabled:(0,N.mQ)(e,t),children:[n&&(0,J.jsx)("span",{style:C.Z,children:"(Superior base) "}),(0,N.GJ)(t)," ",(0,N.mQ)(e,t)&&"*EQUIPPED*",t.enchantment&&(0,J.jsxs)(h.Z,{variant:"subtitle2",sx:{color:"info.main"},children:["\xa0",(0,N.Lt)(t.enchantment)]}),n&&i&&(0,J.jsx)(h.Z,{variant:"caption",sx:{display:"block"},children:i})]},t.id)}))}),(0,J.jsxs)(Z.Z,{variant:"contained",disabled:!g||t||c,color:"error",onClick:async function(){try{await o({variables:{item:n}})}catch(e){}},children:[g&&(0,J.jsxs)(i.Fragment,{children:["Destroy ",(0,N.GJ)(g)]}),!g&&"Select Item"]})]}),(0,J.jsx)("br",{}),(0,J.jsx)("br",{}),l&&(0,J.jsxs)(E.Z,{fullWidth:!0,children:[(0,J.jsx)(q.Z,{id:"filter-select-label",children:"Filter by enchantment"}),(0,J.jsx)(K.Z,{id:"filter-select",labelId:"filter-select-label",value:s||"",label:"Filter by enchantment",onChange:t=>{const n=t.target.value;e.inventory.find((e=>e.enchantment===n))&&r(n)},children:u.map((e=>(0,J.jsxs)(Q.Z,{value:e,children:[(0,N.uD)(e),"???"!==(0,N.Lt)(e)&&(0,J.jsxs)(h.Z,{variant:"subtitle2",sx:{color:"primary.main"},children:["\xa0",(0,N.Lt)(e)]})]},e)))})]})]})}function Jt({hero:e,disabled:t}){let[n,a]=(0,i.useState)(""),[s,r]=(0,i.useState)("");const[o,{loading:c}]=(0,z.mEo)(),d=e.inventory.filter((e=>e.type!==z.$7w.Quest&&!e.enchantment)).sort(N.v4),m={},u=[...e.enchantments].sort().filter((e=>m[e]?(m[e]=(m[e]??0)+1,!1):(m[e]=1,!0)));let x=d.find((e=>e.id===n));!x&&n.length&&(d.length?(x=d[0],n=x.id):n="");let g=u.find((e=>e===s));!g&&s.length&&(u.length?(g=u[0],s=g):s="");const j=x?x.level:0,p="Select base item",b="Select an enchantment";return(0,J.jsxs)(i.Fragment,{children:[(0,J.jsx)(h.Z,{variant:"body1",children:"Enchanting allows you to combine a pure item and pure enchantment into a new enchanted item! You can acquire pure enchantments through disenchanting items."}),(0,J.jsx)("br",{}),(0,J.jsxs)(E.Z,{fullWidth:!0,sx:{margin:1},children:[(0,J.jsx)(q.Z,{id:"enchant-baseItem-select-label",children:p}),(0,J.jsx)(K.Z,{id:"enchant-baseItem-select",labelId:"enchant-baseItem-select-label",value:n||"",label:p,onChange:t=>{const n=t.target.value;e.inventory.find((e=>e.id===n))&&a(n)},children:d.map((t=>{const n=(t.builtIns||[]).length>0,i=(t.builtIns||[]).map((e=>(0,N.xq)(e))).join(", ");return(0,J.jsxs)(Q.Z,{value:t.id,children:[n&&(0,J.jsx)("span",{style:C.Z,children:"(Superior base) "}),(0,N.GJ)(t),(0,N.mQ)(e,t)&&"*EQUIPPED*",n&&i&&(0,J.jsx)(h.Z,{variant:"caption",sx:{display:"block"},children:i})]},t.id)}))})]}),(0,J.jsxs)(E.Z,{fullWidth:!0,sx:{margin:1},children:[(0,J.jsx)(q.Z,{id:"enchant-enchantment-select-label",children:b}),(0,J.jsx)(K.Z,{id:"enchant-enchantment-select",labelId:"enchant-enchantment-select-label",value:s||"",label:b,onChange:e=>{const t=e.target.value,n=u.find((e=>t===e));n&&r(n)},children:u.map((e=>(0,J.jsxs)(Q.Z,{value:e,children:[(0,N.uD)(e)," ",m[e]&&m[e]>1&&`(${m[e]})`,"???"!==(0,N.Lt)(e)&&(0,J.jsxs)(h.Z,{variant:"subtitle2",sx:{color:"primary.main"},children:["\xa0",(0,N.Lt)(e)]})]},e)))})]}),(0,J.jsxs)(Z.Z,{fullWidth:!0,variant:"contained",disabled:!x||t||c||j>e.enchantingDust,color:"success",onClick:async function(){if(""!==s)try{await o({variables:{item:n,enchantment:s}})}catch(e){}},children:[x&&""!==s&&(0,J.jsxs)(l.Z,{children:[(0,J.jsxs)(h.Z,{children:["Create ",(0,J.jsx)("b",{children:(0,N.GJ)(x,s)})]}),(0,J.jsxs)(h.Z,{variant:"subtitle2",children:["Costs ",j.toLocaleString()," Enchantment Dust"]})]}),!x&&"Select Item"]})]})}function Yt({hero:e,disabled:t}){let[n,a]=(0,i.useState)(""),[s,r]=(0,i.useState)("");const o=!!e.inventory.find((e=>(0,N.kJ)(e.baseItem))),[c,{loading:d}]=(0,z.dgo)(),m=e.inventory.filter((t=>t.type!==z.$7w.Quest&&(!(0,N.mQ)(e,t)&&!!t.enchantment))),u=m.filter((e=>""===n||e.enchantment===n)).sort(N.v4),x=m.filter((t=>!(0,N.mQ)(e,t))).map((e=>e.enchantment)).reduce(((e,t)=>t?(e.indexOf(t)<0&&e.push(t),e):e),[]);let g=u.find((e=>e.id===s));!g&&s.length&&(u.length?(g=u[0],s=g.id):s="");const j="Select item to disenchant",p=g?g.level:0;return(0,J.jsxs)(i.Fragment,{children:[(0,J.jsx)(h.Z,{variant:"body1",children:"Select an item to split from its enchantment. You will keep both the base item and the enchantment itself for use in further crafting."}),(0,J.jsx)("br",{}),(0,J.jsxs)(E.Z,{fullWidth:!0,children:[(0,J.jsx)(q.Z,{id:"disenchant-select-label",children:j}),(0,J.jsx)(K.Z,{id:"disenchant-select",labelId:"disenchant-select-label",value:s||"",label:j,onChange:t=>{const n=t.target.value;e.inventory.find((e=>e.id===n))&&r(n)},children:u.map((t=>{const n=(t.builtIns||[]).length>0,i=(t.builtIns||[]).map((e=>(0,N.xq)(e))).join(", ");return(0,J.jsxs)(Q.Z,{value:t.id,disabled:(0,N.mQ)(e,t),children:[n&&(0,J.jsx)("span",{style:C.Z,children:"(Superior base) "}),(0,N.GJ)(t)," ",(0,N.mQ)(e,t)&&"*EQUIPPED*",t.enchantment&&(0,J.jsxs)(h.Z,{variant:"subtitle2",sx:{color:"info.main"},children:["\xa0",(0,N.Lt)(t.enchantment)]}),n&&i&&(0,J.jsx)(h.Z,{variant:"caption",sx:{display:"block"},children:i})]},t.id)}))}),(0,J.jsxs)(Z.Z,{variant:"contained",disabled:!g||t||d||p>e.enchantingDust,color:"error",onClick:async function(){try{await c({variables:{item:s}})}catch(e){}},children:[g&&(0,J.jsxs)(l.Z,{children:[(0,J.jsxs)(h.Z,{children:["Disenchant ",(0,J.jsx)("b",{children:(0,N.GJ)(g)})]}),(0,J.jsxs)(h.Z,{variant:"subtitle2",children:["Costs ",p.toLocaleString()," Enchantment Dust"]})]}),!g&&"Select Item"]})]}),(0,J.jsx)("br",{}),(0,J.jsx)("br",{}),o&&(0,J.jsxs)(E.Z,{fullWidth:!0,children:[(0,J.jsx)(q.Z,{id:"filter-select-label",children:"Filter by enchantment"}),(0,J.jsx)(K.Z,{id:"filter-select",labelId:"filter-select-label",value:n||"",label:"Filter by enchantment",onChange:t=>{const n=t.target.value;e.inventory.find((e=>e.enchantment===n))&&a(n)},children:x.map((e=>(0,J.jsxs)(Q.Z,{value:e,children:[(0,N.uD)(e),"???"!==(0,N.Lt)(e)&&(0,J.jsxs)(h.Z,{variant:"subtitle2",sx:{color:"primary.main"},children:["\xa0",(0,N.Lt)(e)]})]},e)))})]})]})}var Ot=n(3457),Ut=n(480),Vt=n(9368);function Xt({hero:e,disabled:t}){let[n,a]=(0,i.useState)("");const[s,r]=(0,i.useState)([]),[l,{loading:o}]=(0,z.XeQ)(),c=e.inventory.filter((e=>e.type!==z.$7w.Quest&&(!e.enchantment&&e.level>31))).sort(N.v4);let d=c.find((e=>e.id===n));!d&&n.length&&(c.length?(d=c[0],n=d.id):n="");const m="Select base item",u=e.equipment.artifact;if(!u)return(0,J.jsx)(J.Fragment,{children:(0,J.jsx)(h.Z,{children:"You must have an artifact to imbue items with."})});const x=(0,N.Vy)(u);return(0,J.jsxs)(J.Fragment,{children:[(0,J.jsx)(h.Z,{children:"Imbueing an item adds parts of an artifact onto a base item. Items can only be imbued once, and there is no way to remove the imbue. You may enchant an imbued item, however only unenchanted items can receive an imbue."}),(0,J.jsx)("br",{}),(0,J.jsxs)(E.Z,{fullWidth:!0,sx:{margin:1},children:[(0,J.jsx)(q.Z,{id:"enchant-baseItem-select-label",children:m}),(0,J.jsx)(K.Z,{id:"enchant-baseItem-select",labelId:"enchant-baseItem-select-label",value:n||"",label:m,onChange:t=>{const n=t.target.value;e.inventory.find((e=>e.id===n))&&a(n)},children:c.map((t=>{const n=(t.builtIns||[]).length>0;return(0,J.jsxs)(Q.Z,{value:t.id,children:[n&&(0,J.jsx)("span",{style:C.Z,children:"(Superior base) "}),(0,N.GJ)(t),(0,N.mQ)(e,t)&&"*EQUIPPED*"]},t.id)}))})]}),d&&(0,J.jsxs)(J.Fragment,{children:[(0,J.jsxs)(h.Z,{variant:"h5",children:[d.name," to be imbued with"," ",(0,J.jsx)("strong",{children:u.name})]}),(0,J.jsx)(h.Z,{variant:"subtitle1",children:"Select up to three affixes to activate on the item, each affix increases dust cost dramatically. The remaining affixes will be selected randomly from the remaining affixes."}),(0,J.jsx)(Ot.Z,{children:x.map((e=>(0,J.jsx)(Ut.Z,{control:(0,J.jsx)(Vt.Z,{disabled:s.length>=3&&!s.includes(e.type),onChange:t=>{const n=s.filter((t=>t!==e.type));t.target.checked&&n.push(e.type),r(n)}}),label:(0,N.xq)(e)},e.type)))})]}),(0,J.jsx)(Qe.Z,{variant:"contained",disabled:t||!d||0===s.length,loading:t,onClick:async()=>{!t&&d&&0!==s.length&&await l({variables:{item:d.id,artifact:u.id,affixes:s}})},children:"Imbue item"})]})}function en({hero:e,disabled:t}){const[n,a]=(0,i.useState)("1"),s=e.inventory.some((e=>"pure-essence"===e.baseItem)),r=e.inventory.some((e=>"essence-of-void"===e.baseItem)),c=s&&r&&null!==e.equipment.artifact;return(0,J.jsxs)(i.Fragment,{children:[(0,J.jsx)(o.Z,{sx:{margin:2}}),(0,J.jsx)(h.Z,{variant:"h2",component:"h4",color:"secondary",children:"Crafting"}),(0,J.jsxs)(h.Z,{variant:"subtitle1",color:"secondary",children:["Enchanting Dust:"," ",(0,J.jsx)("span",{id:"hero-stats-enchanting-dust",children:e.enchantingDust.toLocaleString()})]}),(0,J.jsxs)(h.Z,{variant:"subtitle1",color:"secondary",children:["Enchantments:"," ",(0,J.jsx)("span",{id:"hero-stats-enchantments",children:e.enchantments.length.toLocaleString()})]}),(0,J.jsx)("br",{}),(0,J.jsx)(w.ZP,{value:n,children:(0,J.jsxs)(l.Z,{sx:{flexGrow:1,borderBottom:1,borderColor:"divider",display:"flex"},children:[(0,J.jsxs)(S.Z,{orientation:"vertical",onChange:(e,t)=>a(t),"aria-label":"navigation tabs",variant:"scrollable",textColor:"secondary",indicatorColor:"secondary",sx:{flexShrink:0,flexGrow:0,width:"100px"},children:[(0,J.jsx)(d.Z,{icon:(0,J.jsx)(dt.Z,{}),label:"Destroy",value:"1"}),(0,J.jsx)(d.Z,{icon:(0,J.jsx)(Qt.Z,{}),label:"Disenchant",value:"2"}),(0,J.jsx)(d.Z,{icon:(0,J.jsx)(Kt.Z,{}),label:"Enchant",value:"3"}),c&&(0,J.jsx)(d.Z,{icon:(0,J.jsx)(Kt.Z,{}),label:"Imbue",value:"4"})]}),(0,J.jsxs)(k.Z,{value:"1",children:[(0,J.jsx)(h.Z,{variant:"h5",sx:C.Z,children:"Destroy Items"}),(0,J.jsx)(_t,{hero:e,disabled:t})]}),(0,J.jsxs)(k.Z,{value:"2",children:[(0,J.jsx)(h.Z,{variant:"h5",sx:C.Z,children:"Disenchant Items"}),(0,J.jsx)(Yt,{hero:e,disabled:t})]}),(0,J.jsxs)(k.Z,{value:"3",children:[(0,J.jsx)(h.Z,{variant:"h5",sx:C.Z,children:"Enchant Items"}),(0,J.jsx)(Jt,{hero:e,disabled:t})]}),c&&(0,J.jsxs)(k.Z,{value:"4",children:[(0,J.jsx)(h.Z,{variant:"h5",sx:C.Z,children:"Imbue Items"}),(0,J.jsx)(Xt,{hero:e,disabled:t})]})]})})]})}function tn({hero:e,disabled:t}){const n=ce()?.voidTravel??!1,[i]=(0,z.hKI)();return(0,J.jsxs)(l.Z,{sx:{padding:1,margin:1},children:[(0,J.jsx)(h.Z,{color:"secondary",variant:"h2",children:"Void Travel"}),(0,J.jsx)(h.Z,{sx:{mb:2},children:"Void dimensions have different rules than the overworld. While each void world which you visit may varry in mechanics, there is one common rule: Death in a void world results in immediate overworld rebirth."}),!n&&(0,J.jsx)(Z.Z,{disabled:!0,size:"large",variant:"outlined",color:"error",children:"You must be near a void conduit"}),n&&(0,J.jsx)(Z.Z,{size:"large",variant:"outlined",color:"secondary",onClick:()=>i(),children:"Travel to the void"})]})}function nn({hero:e,itemId:t,disabled:n}){const[a,{data:s,loading:r,error:o}]=(0,z.JaR)(),[c,d]=(0,i.useState)("");return(0,i.useEffect)((()=>{s?.readMap?.message&&d(s.readMap.message)}),[s]),(0,i.useEffect)((()=>{d("")}),[t]),(0,J.jsxs)(l.Z,{sx:{mt:1},children:[(0,J.jsx)(h.Z,{variant:"h3",sx:{fontSize:"1.2rem",mb:1},children:"Treasure Map"}),(0,J.jsxs)(l.Z,{sx:{display:"flex",gap:1,alignItems:"center",mb:1},children:[(0,J.jsx)(Z.Z,{variant:"contained",size:"small",onClick:async function(){if(t)try{await a({variables:{itemId:t}})}catch(e){}},disabled:n||!t||r,children:r?"Reading...":"Read Map"}),!t&&(0,J.jsx)(h.Z,{variant:"caption",color:"text.secondary",children:"Select a Treasure Map to read"})]}),o&&(0,J.jsx)(h.Z,{variant:"body2",color:"error",children:String(o.message||o)}),c&&(0,J.jsx)(h.Z,{variant:"body2",sx:{whiteSpace:"pre-wrap"},children:c})]})}function an(e){return e===z.$7w.MeleeWeapon||e===z.$7w.RangedWeapon||e===z.$7w.SpellFocus}function sn(e){return e===z.$7w.BodyArmor||e===z.$7w.HandArmor||e===z.$7w.LegArmor||e===z.$7w.HeadArmor||e===z.$7w.FootArmor||e===z.$7w.Shield}const rn={[z.$7w.BodyArmor]:1,[z.$7w.FootArmor]:3,[z.$7w.HandArmor]:3,[z.$7w.HeadArmor]:2,[z.$7w.LegArmor]:2,[z.$7w.Shield]:1,[z.$7w.Accessory]:0,[z.$7w.MeleeWeapon]:0,[z.$7w.Quest]:0,[z.$7w.RangedWeapon]:0,[z.$7w.SpellFocus]:0};function ln(e){const t=e.baseDamage;if("number"===typeof t)return t;if(!an(e.type))return;const n=function(e){const t=Math.max(1,Math.pow(1.05,e)*e*8+20);return Math.round(t)}(e.level),i=(e.builtIns||[]).filter((e=>e.type===z.WBn.ItemFlatDamage)).reduce(((e,t)=>e+t.magnitude),0),a=(e.builtIns||[]).filter((e=>e.type===z.WBn.ItemBonusDamage)).reduce(((e,t)=>e+t.magnitude),0),s=a?a>=1?a:1+a:1;return Math.round(n*s+i)}function on(e){const t=e.baseArmor;if("number"===typeof t)return t;if(!sn(e.type))return;const n=function(e,t){if(e<1)return 0;const n=Math.round((e/2+Math.log(e))*Math.pow(e,1.3)),i=rn[t]??1,a=i>0?(n+i)/i:0;return Math.round(a)}(e.level,e.type),i=(e.builtIns||[]).filter((e=>e.type===z.WBn.ItemFlatArmor)).reduce(((e,t)=>e+t.magnitude),0),a=(e.builtIns||[]).filter((e=>e.type===z.WBn.ItemBonusArmor)).reduce(((e,t)=>e+t.magnitude),0),s=a?a>=1?a:1+a:1;return Math.round(n*s+i)}function cn({hero:e,slot:t,label:n,onEquip:a,disabled:s}){const r=e.equipment[t]?.id,l=["leftHand","rightHand","bodyArmor","handArmor","legArmor","headArmor","footArmor"].filter((n=>e.equipment[n]&&n!==t)).map((t=>e.equipment[t]?.id)),[o,c]=(0,i.useState)(r||""),d=e.inventory.filter((e=>function(e,t){switch(e){case"rightHand":case"leftHand":return t.type===z.$7w.MeleeWeapon||t.type===z.$7w.RangedWeapon||t.type===z.$7w.Shield||t.type===z.$7w.SpellFocus;case"bodyArmor":return t.type===z.$7w.BodyArmor;case"handArmor":return t.type===z.$7w.HandArmor;case"legArmor":return t.type===z.$7w.LegArmor;case"headArmor":return t.type===z.$7w.HeadArmor;case"footArmor":return t.type===z.$7w.FootArmor;default:return!1}}(t,e))).sort(N.v4),m={};d.forEach((e=>{const t=(0,N.GJ)(e);m[t]?m[t]+=1:m[t]=1}));const u=Object.keys(m).map((e=>d.find((t=>(0,N.GJ)(t)===e)))),x=d.find((e=>e.id===r));return x&&!u.find((e=>e.id===r))&&(u.push(x),m[(0,N.GJ)(x)]-=1),l.forEach((e=>{const t=u.find((t=>t.id===e));if(t){const n=(0,N.GJ)(t);if(m[n]>1){const t=d.find((t=>(0,N.GJ)(t)===n&&t.id!==e));t&&(u.push(t),m[n]-=1)}}})),u.sort(N.v4),(0,J.jsx)(i.Fragment,{children:(0,J.jsx)("div",{children:(0,J.jsxs)(E.Z,{fullWidth:!0,children:[(0,J.jsx)(q.Z,{id:`${t}-equip-select-label`,children:n}),(0,J.jsx)(K.Z,{id:`${t}-equip-select`,labelId:`${t}-equip-select-label`,value:r||"",label:n,disabled:s,onChange:e=>{c(e.target.value),a(t,e.target.value)},children:u.map((e=>{const t=(e.builtIns||[]).length>0,n=(e.builtIns||[]).map((e=>(0,N.xq)(e))).join(", ");return(0,J.jsxs)(Q.Z,{value:e.id,disabled:l.indexOf(e.id)>=0,children:[t&&(0,J.jsx)("span",{style:C.Z,children:"(Superior base) "}),e.id===r?(0,J.jsx)("b",{children:(0,N.GJ)(e)}):(0,J.jsxs)(J.Fragment,{children:[(0,N.GJ)(e),m[(0,N.GJ)(e)]>1&&-1===l.indexOf(e.id)?` x${m[(0,N.GJ)(e)]}`:""]}),an(e.type)?(0,J.jsxs)(h.Z,{variant:"caption",sx:{color:"info.secondary"},children:["\xa0",ln(e)??"\u2014"," Damage"]}):sn(e.type)?(0,J.jsxs)(h.Z,{variant:"caption",sx:{color:"info.secondary"},children:["\xa0",on(e)??"\u2014"," Armor"]}):(0,J.jsxs)(h.Z,{variant:"caption",sx:{color:"info.secondary"},children:["\xa0Lvl. ",e.level]}),e.enchantment&&(0,J.jsxs)(h.Z,{variant:"subtitle2",sx:{color:"info.main"},children:["\xa0",(0,N.Lt)(e.enchantment)]}),t&&n&&(0,J.jsx)(h.Z,{variant:"caption",sx:{display:"block"},children:n})]},e.id)}))})]})})})}function dn({hero:e,disabled:t,onChange:n,onSelectItemId:a}){const[s,r]=(0,i.useState)(""),l=e.inventory.filter((e=>e.type===z.$7w.Quest)).sort(((e,t)=>t.level-e.level)),o="Quest items (passive, always active)",c=e.inventory.find((e=>e.id===s));(0,i.useEffect)((()=>{s.length&&!c&&r("")}),[c,s]);const d={};l.forEach((e=>{const t=(0,N.GJ)(e);d[t]?d[t]+=1:d[t]=1}));const m=Object.keys(d).map((e=>l.find((t=>(0,N.GJ)(t)===e))));return(0,J.jsx)(i.Fragment,{children:(0,J.jsx)("div",{children:(0,J.jsxs)(E.Z,{fullWidth:!0,children:[(0,J.jsx)(q.Z,{id:"quest-item-label",children:o}),(0,J.jsx)(K.Z,{id:"quest-item",labelId:"quest-item-label",value:s,label:o,disabled:t,onChange:e=>{if(r(e.target.value),a&&a(e.target.value),n){const t=l.find((t=>t.id===e.target.value));t&&n(t.baseItem)}},children:m.map((e=>(0,J.jsxs)(Q.Z,{value:e.id,"data-testid":e.baseItem,children:[(0,J.jsxs)(J.Fragment,{children:[(0,N.GJ)(e),d[(0,N.GJ)(e)]>1?` x${d[(0,N.GJ)(e)]}`:""]}),"???"!==(0,N.Lt)(e.baseItem)&&(0,J.jsxs)(h.Z,{variant:"subtitle2",sx:{color:"primary.main"},children:["\xa0",(0,N.Lt)(e.baseItem)]})]},e.id)))})]})})})}var hn=n(7906),mn=n(295),un=n(3252),xn=n(2882),gn=n(3184),jn=n(3816),pn=n(6280);const bn={[z.$7w.BodyArmor]:1,[z.$7w.FootArmor]:3,[z.$7w.HandArmor]:3,[z.$7w.HeadArmor]:2,[z.$7w.LegArmor]:2,[z.$7w.Shield]:1,[z.$7w.Accessory]:0,[z.$7w.MeleeWeapon]:0,[z.$7w.Quest]:0,[z.$7w.RangedWeapon]:0,[z.$7w.SpellFocus]:0};function yn(e){if(!Zn(e.type))return;const t=function(e){const t=Math.max(1,Math.pow(1.05,e)*e*8+20);return Math.round(t)}(e.level),n=(e.builtIns||[]).filter((e=>e.type===z.WBn.ItemFlatDamage)).reduce(((e,t)=>e+t.magnitude),0),i=(e.builtIns||[]).filter((e=>e.type===z.WBn.ItemBonusDamage)).reduce(((e,t)=>e+t.magnitude),0),a=i?i>=1?i:1+i:1;return Math.round(t*a+n)}function fn(e){if(!vn(e.type))return;const t=function(e,t){if(e<1)return 0;const n=Math.round((e/2+Math.log(e))*Math.pow(e,1.3)),i=bn[t]??1,a=i>0?(n+i)/i:0;return Math.round(a)}(e.level,e.type),n=(e.builtIns||[]).filter((e=>e.type===z.WBn.ItemFlatArmor)).reduce(((e,t)=>e+t.magnitude),0),i=(e.builtIns||[]).filter((e=>e.type===z.WBn.ItemBonusArmor)).reduce(((e,t)=>e+t.magnitude),0),a=i?i>=1?i:1+i:1;return Math.round(t*a+n)}function Zn(e){return e===z.$7w.MeleeWeapon||e===z.$7w.RangedWeapon||e===z.$7w.SpellFocus}function vn(e){return e===z.$7w.BodyArmor||e===z.$7w.HandArmor||e===z.$7w.LegArmor||e===z.$7w.HeadArmor||e===z.$7w.FootArmor||e===z.$7w.Shield}function wn(e,t){switch(t){case"name":return(0,N.GJ)(e).toLowerCase();case"type":return e.type;case"level":return e.level;case"baseDmg":return Zn(e.type)?"number"===typeof e.baseDamage?e.baseDamage:yn(e)??0:0;case"baseArmor":return vn(e.type)?"number"===typeof e.baseArmor?e.baseArmor:fn(e)??0:0}}function Sn({hero:e,onEquip:t,disabled:n}){const[a,s]=(0,i.useState)(""),[r,o]=(0,i.useState)("all"),[c,d]=(0,i.useState)("level"),[u,x]=(0,i.useState)(!1),[g,j]=(0,i.useState)(0),p=200,b=e.inventory,y=(0,i.useMemo)((()=>{const e=a.trim().toLowerCase();let t=b;return"all"!==r&&(t=t.filter((e=>e.type===r))),e&&(t=t.filter((t=>{const n=(0,N.GJ)(t).toLowerCase(),i=t.enchantment?(0,N.Lt)(t.enchantment).toLowerCase():"",a=(t.builtIns||[]).map((e=>(0,N.xq)(e).toLowerCase())).join(" ");return n.includes(e)||i.includes(e)||a.includes(e)}))),t}),[b,a,r]),f=(0,i.useMemo)((()=>{const e=[...y];return e.sort(((e,t)=>{const n=wn(e,c),i=wn(t,c);if(n<i)return u?-1:1;if(n>i)return u?1:-1;const a=wn(e,"level"),s=wn(t,"level");return a!==s?u?a-s:s-a:(0,N.GJ)(e).localeCompare((0,N.GJ)(t))})),e}),[y,c,u]),v=Math.max(1,Math.ceil(f.length/p)),w=Math.min(g,v-1),S=f.slice(w*p,w*p+p);function k(e){e===c?x(!u):(d(e),x("name"===e||"type"===e))}return e?(0,J.jsxs)(l.Z,{sx:{mt:2},children:[(0,J.jsx)(h.Z,{variant:"h3",sx:{fontSize:"1.2rem",mb:1},children:"Inventory Browser"}),(0,J.jsxs)(m.ZP,{container:!0,spacing:1,columns:12,sx:{mb:1},children:[(0,J.jsx)(m.ZP,{item:!0,xs:12,sm:6,md:8,children:(0,J.jsx)(_.Z,{fullWidth:!0,size:"small",label:"Search inventory",placeholder:"Search by name, enchantment, or modifier",inputProps:{"aria-label":"Search inventory"},value:a,onChange:e=>{s(e.target.value),j(0)}})}),(0,J.jsx)(m.ZP,{item:!0,xs:12,sm:6,md:4,children:(0,J.jsxs)(E.Z,{fullWidth:!0,size:"small",children:[(0,J.jsx)(q.Z,{id:"inventory-type-filter-label",children:"Filter by type"}),(0,J.jsxs)(K.Z,{labelId:"inventory-type-filter-label",label:"Filter by type",value:r,onChange:e=>{o(e.target.value),j(0)},children:[(0,J.jsx)(Q.Z,{value:"all",children:"All"}),Object.values(z.$7w).map((e=>(0,J.jsx)(Q.Z,{value:e,children:e},e)))]})]})})]}),(0,J.jsx)(xn.Z,{component:O.Z,"aria-label":"Inventory items table",children:(0,J.jsxs)(hn.Z,{size:"small",children:[(0,J.jsx)(gn.Z,{children:(0,J.jsxs)(jn.Z,{children:[(0,J.jsx)(un.Z,{sortDirection:"name"===c&&(u?"asc":"desc"),children:(0,J.jsxs)(pn.Z,{active:"name"===c,direction:"name"===c&&u?"asc":"desc",onClick:()=>k("name"),children:["Name","name"===c?(0,J.jsx)(l.Z,{component:"span",sx:C.Z,children:u?"sorted ascending":"sorted descending"}):null]})}),(0,J.jsx)(un.Z,{children:"Enchant"}),(0,J.jsx)(un.Z,{sortDirection:"type"===c&&(u?"asc":"desc"),children:(0,J.jsx)(pn.Z,{active:"type"===c,direction:"type"===c&&u?"asc":"desc",onClick:()=>k("type"),children:"Type"})}),(0,J.jsx)(un.Z,{align:"right",sortDirection:"level"===c&&(u?"asc":"desc"),children:(0,J.jsx)(pn.Z,{active:"level"===c,direction:"level"===c&&u?"asc":"desc",onClick:()=>k("level"),children:"Lvl"})}),(0,J.jsx)(un.Z,{align:"right",sortDirection:"baseDmg"===c&&(u?"asc":"desc"),children:(0,J.jsx)(pn.Z,{active:"baseDmg"===c,direction:"baseDmg"===c&&u?"asc":"desc",onClick:()=>k("baseDmg"),children:"Base Dmg"})}),(0,J.jsx)(un.Z,{align:"right",sortDirection:"baseArmor"===c&&(u?"asc":"desc"),children:(0,J.jsx)(pn.Z,{active:"baseArmor"===c,direction:"baseArmor"===c&&u?"asc":"desc",onClick:()=>k("baseArmor"),children:"Armor"})}),(0,J.jsx)(un.Z,{children:"Built-ins"}),(0,J.jsx)(un.Z,{align:"right",children:"Actions"})]})}),(0,J.jsxs)(mn.Z,{children:[S.map((i=>{const a=(0,N.GJ)(i),s=i.baseDamage??yn(i),r=i.baseArmor??fn(i),o=(i.builtIns||[]).map((e=>(0,N.xq)(e))).join(", "),c=function(e){switch(e.type){case z.$7w.MeleeWeapon:case z.$7w.RangedWeapon:case z.$7w.Shield:case z.$7w.SpellFocus:return["leftHand","rightHand"];case z.$7w.BodyArmor:return["bodyArmor"];case z.$7w.HandArmor:return["handArmor"];case z.$7w.LegArmor:return["legArmor"];case z.$7w.HeadArmor:return["headArmor"];case z.$7w.FootArmor:return["footArmor"];default:return[]}}(i),d=(0,N.mQ)(e,i);return(0,J.jsxs)(jn.Z,{hover:!0,selected:d,"aria-selected":d,children:[(0,J.jsxs)(un.Z,{children:[(0,J.jsx)(h.Z,{component:"span",children:a}),d&&(0,J.jsx)(h.Z,{component:"span",variant:"caption",color:"success.main",sx:{ml:1,fontWeight:700},children:"*EQUIPPED*"})]}),(0,J.jsx)(un.Z,{children:i.enchantment?(0,J.jsx)(h.Z,{variant:"body2",color:"info.main",children:(0,N.Lt)(i.enchantment)}):(0,J.jsx)(h.Z,{variant:"body2",color:"text.secondary",children:"\u2014"})}),(0,J.jsx)(un.Z,{children:i.type}),(0,J.jsx)(un.Z,{align:"right",children:i.level}),(0,J.jsx)(un.Z,{align:"right",children:s??"\u2014"}),(0,J.jsx)(un.Z,{align:"right",children:r??"\u2014"}),(0,J.jsx)(un.Z,{children:o?(0,J.jsx)(h.Z,{variant:"caption",children:o}):(0,J.jsx)(h.Z,{variant:"caption",color:"text.secondary",children:"\u2014"})}),(0,J.jsx)(un.Z,{align:"right",children:c.length?(0,J.jsx)(l.Z,{sx:{display:"flex",gap:1,justifyContent:"flex-end"},children:c.map((e=>(0,J.jsx)(Z.Z,{size:"small",variant:"outlined",disabled:n,"aria-label":`Equip ${a} to ${e}`,onClick:()=>t(e,i.id),children:"leftHand"===e?"Left":"rightHand"===e?"Right":"Equip"},e)))}):(0,J.jsx)(h.Z,{variant:"caption",color:"text.secondary",children:"\u2014"})})]},i.id)})),0===S.length&&(0,J.jsx)(jn.Z,{children:(0,J.jsx)(un.Z,{colSpan:8,align:"center",children:(0,J.jsx)(h.Z,{variant:"body2",color:"text.secondary",children:"No items match your filters."})})})]})]})}),(0,J.jsxs)(l.Z,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mt:1},children:[(0,J.jsxs)(h.Z,{variant:"caption",children:["Showing ",S.length," of ",f.length," items"]}),(0,J.jsxs)(l.Z,{sx:{display:"flex",gap:1},children:[(0,J.jsx)(Z.Z,{size:"small",onClick:()=>j(0),disabled:0===w,"aria-label":"First page",children:"\xab First"}),(0,J.jsx)(Z.Z,{size:"small",onClick:()=>j(Math.max(0,w-1)),disabled:0===w,"aria-label":"Previous page",children:"\u2039 Prev"}),(0,J.jsxs)(h.Z,{variant:"caption",component:"span","aria-live":"polite",children:["Page ",w+1," / ",v]}),(0,J.jsx)(Z.Z,{size:"small",onClick:()=>j(Math.min(v-1,w+1)),disabled:w>=v-1,"aria-label":"Next page",children:"Next \u203a"}),(0,J.jsx)(Z.Z,{size:"small",onClick:()=>j(v-1),disabled:w>=v-1,"aria-label":"Last page",children:"Last \xbb"})]})]})]}):null}function kn(){const[e]=(0,oe.gZ)(),[t,{loading:n}]=(0,z.aPk)(),[a,s]=(0,i.useState)(""),[r,l]=(0,i.useState)(""),o=R(),c=n||e>0;if(!o)return null;async function d(e,n){try{await t({variables:{item:n,slot:e}})}catch(i){}}return(0,J.jsx)(i.Fragment,{children:(0,J.jsxs)(m.ZP,{container:!0,columns:6,spacing:1,children:[(0,J.jsx)(m.ZP,{item:!0,xs:6,children:(0,J.jsx)(h.Z,{variant:"h3",sx:{fontSize:"1.2rem"},children:"Equipped items"})}),(0,J.jsx)(m.ZP,{item:!0,xs:6,sm:3,children:(0,J.jsx)(cn,{hero:o,slot:"leftHand",label:"Left Hand",onEquip:d,disabled:c})}),(0,J.jsx)(m.ZP,{item:!0,xs:6,sm:3,children:(0,J.jsx)(cn,{hero:o,slot:"rightHand",label:"Right Hand",onEquip:d,disabled:c})}),(0,J.jsx)(m.ZP,{item:!0,xs:6,sm:3,children:(0,J.jsx)(cn,{hero:o,slot:"bodyArmor",label:"Body Armor",onEquip:d,disabled:c})}),(0,J.jsx)(m.ZP,{item:!0,xs:6,sm:3,children:(0,J.jsx)(cn,{hero:o,slot:"handArmor",label:"Gauntlets",onEquip:d,disabled:c})}),(0,J.jsx)(m.ZP,{item:!0,xs:6,sm:3,children:(0,J.jsx)(cn,{hero:o,slot:"legArmor",label:"Leggings",onEquip:d,disabled:c})}),(0,J.jsx)(m.ZP,{item:!0,xs:6,sm:3,children:(0,J.jsx)(cn,{hero:o,slot:"headArmor",label:"Helmets",onEquip:d,disabled:c})}),(0,J.jsx)(m.ZP,{item:!0,xs:6,sm:3,children:(0,J.jsx)(cn,{hero:o,slot:"footArmor",label:"Greaves",onEquip:d,disabled:c})}),(0,J.jsx)(m.ZP,{item:!0,xs:6,sm:3,children:(0,J.jsx)(dn,{hero:o,disabled:c,onChange:s,onSelectItemId:l})}),(0,J.jsx)(m.ZP,{item:!0,xs:6,children:(0,J.jsxs)(m.ZP,{container:!0,columns:6,spacing:1,children:[(0,J.jsx)(m.ZP,{item:!0,xs:6,sm:3,children:!!o.buffs.blessing&&(0,J.jsxs)(i.Fragment,{children:[(0,J.jsx)(h.Z,{children:(0,N.uD)(o.buffs.blessing)}),(0,J.jsx)(h.Z,{variant:"body1",children:(0,J.jsx)("b",{children:(0,N.Lt)(o.buffs.blessing)})})]})}),(0,J.jsx)(m.ZP,{item:!0,xs:6,md:3,children:(0,J.jsx)(U,{title:o.equipment.artifact?.name,artifact:o.equipment.artifact})}),(0,J.jsxs)(m.ZP,{item:!0,xs:6,sm:3,children:[(0,J.jsx)(U,{title:o.equipment.leftHand?(0,N.GJ)(o.equipment.leftHand,null):null,artifact:o.equipment.leftHand?.imbue?.artifact,affixes:o.equipment.leftHand?.imbue?.affixes}),(0,J.jsx)(Rt,{title:o.equipment.leftHand?(0,N.GJ)(o.equipment.leftHand,null):null,builtIns:o.equipment.leftHand?.builtIns||[]})]}),(0,J.jsxs)(m.ZP,{item:!0,xs:6,sm:3,children:[(0,J.jsx)(U,{title:o.equipment.rightHand?(0,N.GJ)(o.equipment.rightHand,null):null,artifact:o.equipment.rightHand?.imbue?.artifact,affixes:o.equipment.rightHand?.imbue?.affixes}),(0,J.jsx)(Rt,{title:o.equipment.rightHand?(0,N.GJ)(o.equipment.rightHand,null):null,builtIns:o.equipment.rightHand?.builtIns||[]})]}),(0,J.jsxs)(m.ZP,{item:!0,xs:6,sm:3,children:[(0,J.jsx)(U,{title:o.equipment.bodyArmor?(0,N.GJ)(o.equipment.bodyArmor,null):null,artifact:o.equipment.bodyArmor?.imbue?.artifact,affixes:o.equipment.bodyArmor?.imbue?.affixes}),(0,J.jsx)(Rt,{title:o.equipment.bodyArmor?(0,N.GJ)(o.equipment.bodyArmor,null):null,builtIns:o.equipment.bodyArmor?.builtIns||[]})]}),(0,J.jsxs)(m.ZP,{item:!0,xs:6,sm:3,children:[(0,J.jsx)(U,{title:o.equipment.handArmor?(0,N.GJ)(o.equipment.handArmor,null):null,artifact:o.equipment.handArmor?.imbue?.artifact,affixes:o.equipment.handArmor?.imbue?.affixes}),(0,J.jsx)(Rt,{title:o.equipment.handArmor?(0,N.GJ)(o.equipment.handArmor,null):null,builtIns:o.equipment.handArmor?.builtIns||[]})]}),(0,J.jsxs)(m.ZP,{item:!0,xs:6,sm:3,children:[(0,J.jsx)(U,{title:o.equipment.legArmor?(0,N.GJ)(o.equipment.legArmor,null):null,artifact:o.equipment.legArmor?.imbue?.artifact,affixes:o.equipment.legArmor?.imbue?.affixes}),(0,J.jsx)(Rt,{title:o.equipment.legArmor?(0,N.GJ)(o.equipment.legArmor,null):null,builtIns:o.equipment.legArmor?.builtIns||[]})]}),(0,J.jsxs)(m.ZP,{item:!0,xs:6,sm:3,children:[(0,J.jsx)(U,{title:o.equipment.headArmor?(0,N.GJ)(o.equipment.headArmor,null):null,artifact:o.equipment.headArmor?.imbue?.artifact,affixes:o.equipment.headArmor?.imbue?.affixes}),(0,J.jsx)(Rt,{title:o.equipment.headArmor?(0,N.GJ)(o.equipment.headArmor,null):null,builtIns:o.equipment.headArmor?.builtIns||[]})]}),(0,J.jsxs)(m.ZP,{item:!0,xs:6,sm:3,children:[(0,J.jsx)(U,{title:o.equipment.footArmor?(0,N.GJ)(o.equipment.footArmor,null):null,artifact:o.equipment.footArmor?.imbue?.artifact,affixes:o.equipment.footArmor?.imbue?.affixes}),(0,J.jsx)(Rt,{title:o.equipment.footArmor?(0,N.GJ)(o.equipment.footArmor,null):null,builtIns:o.equipment.footArmor?.builtIns||[]})]})]})}),o.level===o.levelCap&&(0,N.jr)(a)&&(0,J.jsx)(m.ZP,{item:!0,xs:6,children:(0,J.jsx)(Nt,{hero:o,disabled:c})}),(0,N.OB)(a)&&(0,J.jsx)(m.ZP,{item:!0,xs:6,children:(0,J.jsx)(en,{hero:o,disabled:c})}),(0,N.jj)(a)&&(0,J.jsx)(m.ZP,{item:!0,xs:6,children:(0,J.jsx)(tn,{hero:o,disabled:c})}),(0,N.Hd)(a)&&(0,J.jsx)(m.ZP,{item:!0,xs:6,children:(0,J.jsx)(nn,{hero:o,itemId:r||void 0,disabled:c})}),(0,J.jsx)(m.ZP,{item:!0,xs:6,children:(0,J.jsx)(Sn,{hero:o,onEquip:d,disabled:c})})]})})}function Cn({event:e}){const{message:t}=e,[n,{loading:i}]=(0,z.PF1)();function a(){n()}return(0,J.jsx)(u.Z,{children:(0,J.jsxs)(X.Z,{open:!0,onClose:a,"aria-labelledby":"quest-event-title","aria-describedby":"quest-event-description",role:"dialog",children:[(0,J.jsx)(ee.Z,{id:"quest-event-title",tabIndex:0,children:"Quest Event"}),(0,J.jsx)(te.Z,{children:(0,J.jsx)(l.Z,{id:"quest-event-description",tabIndex:0,children:t&&t.map(((e,t)=>(0,J.jsx)(Ke.Z,{children:e},`${t}`)))})}),(0,J.jsx)(ne.Z,{children:(0,J.jsx)(Z.Z,{variant:"contained",color:"error",onClick:a,disabled:i,"data-testid":"quest-continue-button","aria-label":"Continue and dismiss quest dialog",children:"Continue"})})]})})}var Pn=n(2280),An=n(8895),$n=n(2797),Ln=n(3508),In=n(888),Fn=n(8304);function Mn({quest:e}){const[t,n]=(0,i.useState)(!1),[a,s]=(0,i.useState)(!1),r=e?.eventHistory&&e.eventHistory.length?e.eventHistory[e.eventHistory.length-1]?.quest:e?.lastEvent?.quest,{data:o,loading:d}=(0,z.QTh)({variables:r?{quest:r}:void 0,skip:!r});if(!r||d||!o)return(0,J.jsx)("div",{});const m=o.quest;let u=e.progress||1;return u=Math.log2(u),(0,J.jsxs)(Pn.Z,{children:[(0,J.jsx)(An.Z,{expandIcon:(0,J.jsx)(Ln.Z,{}),children:(0,J.jsxs)(Ce.Z,{direction:"row",sx:{width:"100%"},spacing:1,children:[e.finished&&(0,J.jsx)(In.Z,{}),!e.finished&&(0,J.jsx)(Fn.Z,{}),(0,J.jsxs)(Ce.Z,{sx:{width:"100%"},children:[(0,J.jsx)(h.Z,{sx:{lineHeight:3},children:(0,N.qh)(m.id)}),(0,J.jsx)(c.Z,{variant:"determinate",color:e.finished?"success":"secondary",value:e.finished?100:100*u/(u+1)})]})]})}),(0,J.jsxs)($n.Z,{children:[(0,J.jsx)(h.Z,{children:m.description}),(()=>{const t=e.eventHistory??(e.lastEvent?[e.lastEvent]:[]);if(!t.length)return null;const n=t[t.length-1],i=t.slice(0,-1),r=`previous-events-${e.id}`;return(0,J.jsxs)(l.Z,{sx:{marginTop:2},children:[(0,J.jsxs)(l.Z,{role:"region","aria-label":"Most recent quest event",sx:{bgcolor:e.finished?"success.light":"info.light",color:e.finished?"success.contrastText":"info.contrastText",margin:2,padding:2,borderLeft:6,borderLeftStyle:"solid",borderLeftColor:e.finished?"success.main":"info.main",borderRadius:1},children:[(0,J.jsx)(h.Z,{variant:"h6",children:"Most recent event"}),n.message?.map(((e,t)=>(0,J.jsx)(h.Z,{sx:{fontStyle:"italic"},children:e},`${n.id}-${t}`)))]}),i.length>0&&(0,J.jsxs)(J.Fragment,{children:[(0,J.jsx)(Z.Z,{onClick:()=>s(!a),"aria-expanded":a,"aria-controls":r,size:"small",children:a?"Hide previous events":`Show previous events (${i.length})`}),(0,J.jsx)(l.Z,{id:r,"aria-hidden":!a,sx:{display:a?"block":"none",marginTop:1},children:[...i].reverse().map((e=>(0,J.jsx)(l.Z,{sx:{bgcolor:"warning.light",color:"warning.contrastText",margin:2,padding:2,borderRadius:1},children:e.message?.map(((t,n)=>(0,J.jsx)(h.Z,{sx:{fontStyle:"italic"},children:t},`${e.id}-${n}`)))},e.id)))})]})]})})()]})]})}function En(){const e=R();if(!e)return null;const{questLog:t,currentQuest:n}=e;return 2===Object.values(t).filter((e=>!!e)).length?(0,J.jsx)(l.Z,{children:"You have not yet started any quests. Explore the world and grow stronger."}):(0,J.jsxs)(l.Z,{children:[(0,J.jsx)(h.Z,{variant:"h4",children:"Quest Log"}),(0,J.jsx)("br",{}),Object.values(t).filter((e=>!!e&&"string"!==typeof e)).sort(((e,t)=>e.finished?t.finished?t.progress-e.progress:1:t.finished?-1:t.progress-e.progress)).map((e=>e&&"string"!==typeof e?(0,J.jsx)(Mn,{quest:e},e.id):null))]})}function qn(e,t){return`${(Math.round(e/t*1e3)/10).toLocaleString()}%`}function Wn({stats:e,skills:t}){return(0,J.jsx)(l.Z,{children:(0,J.jsxs)(m.ZP,{container:!0,columns:6,spacing:2,children:[(0,J.jsxs)(m.ZP,{item:!0,xs:6,sm:3,md:2,lg:2,children:[(0,J.jsx)("b",{children:"Strength"}),": ",e.stats.strength.toLocaleString()]}),(0,J.jsxs)(m.ZP,{item:!0,xs:6,sm:3,md:2,lg:2,children:[(0,J.jsx)("b",{children:"Dexterity"}),": ",e.stats.dexterity.toLocaleString()]}),(0,J.jsxs)(m.ZP,{item:!0,xs:6,sm:3,md:2,lg:2,children:[(0,J.jsx)("b",{children:"Constitution"}),": ",e.stats.constitution.toLocaleString()]}),(0,J.jsxs)(m.ZP,{item:!0,xs:6,sm:3,md:2,lg:2,children:[(0,J.jsx)("b",{children:"Intelligence"}),": ",e.stats.intelligence.toLocaleString()]}),(0,J.jsxs)(m.ZP,{item:!0,xs:6,sm:3,md:2,lg:2,children:[(0,J.jsx)("b",{children:"Wisdom"}),": ",e.stats.wisdom.toLocaleString()]}),(0,J.jsxs)(m.ZP,{item:!0,xs:6,sm:3,md:2,lg:2,children:[(0,J.jsx)("b",{children:"Willpower"}),": ",e.stats.willpower.toLocaleString()]}),(0,J.jsxs)(m.ZP,{item:!0,xs:6,sm:3,md:2,lg:2,children:[(0,J.jsx)("b",{children:"Luck"}),": ",e.stats.luck.toLocaleString()]}),(0,J.jsxs)(m.ZP,{item:!0,xs:6,sm:3,md:2,lg:2,children:[(0,J.jsx)("b",{children:"Armor"}),": ",e.armor.toLocaleString()]}),(0,J.jsxs)(m.ZP,{item:!0,xs:6,sm:3,md:2,lg:2,children:[(0,J.jsx)("b",{children:"Damage"}),": ",e.baseDamage.toLocaleString(),e.secondAttackBaseDamage>1&&e.secondAttackBaseDamage!==e.baseDamage&&` (${e.secondAttackBaseDamage.toLocaleString()})`,e.damageAmplification>1&&` +${qn(e.damageAmplification-1,1)}`]}),(0,J.jsxs)(m.ZP,{item:!0,xs:6,sm:3,md:2,lg:2,children:[(0,J.jsx)("b",{children:"Accuracy Rating"}),": ",e.attackRating.toLocaleString()]}),(0,J.jsxs)(m.ZP,{item:!0,xs:6,sm:3,md:2,lg:2,children:[(0,J.jsx)("b",{children:"Physical Evasion"}),":"," ",e.physicalEvasionRating.toLocaleString()]}),(0,J.jsxs)(m.ZP,{item:!0,xs:6,sm:3,md:2,lg:2,children:[(0,J.jsx)("b",{children:"Magical Evasion"}),": ",e.magicEvasionRating.toLocaleString()]}),(0,J.jsxs)(m.ZP,{item:!0,xs:6,children:[(0,J.jsx)(o.Z,{}),(0,J.jsx)(h.Z,{variant:"h6",children:"Skills"})]}),(0,J.jsxs)(m.ZP,{item:!0,xs:6,sm:3,md:2,lg:2,children:[(0,J.jsx)("b",{children:"Attacking Accuracy"}),": ",t.attackingAccuracy.toLocaleString()]}),(0,J.jsxs)(m.ZP,{item:!0,xs:6,sm:3,md:2,lg:2,children:[(0,J.jsx)("b",{children:"Attacking Damage"}),": ",t.attackingDamage.toLocaleString()]}),(0,J.jsxs)(m.ZP,{item:!0,xs:6,sm:3,md:2,lg:2,children:[(0,J.jsx)("b",{children:"Casting Accuracy"}),": ",t.castingAccuracy.toLocaleString()]}),(0,J.jsxs)(m.ZP,{item:!0,xs:6,sm:3,md:2,lg:2,children:[(0,J.jsx)("b",{children:"Casting Damage"}),": ",t.castingDamage.toLocaleString()]}),(0,J.jsxs)(m.ZP,{item:!0,xs:6,sm:3,md:2,lg:2,children:[(0,J.jsx)("b",{children:"Vitality"}),": ",t.vitality.toLocaleString()]}),(0,J.jsxs)(m.ZP,{item:!0,xs:6,sm:3,md:2,lg:2,children:[(0,J.jsx)("b",{children:"Resilience"}),": ",t.resilience.toLocaleString()]}),(0,J.jsxs)(m.ZP,{item:!0,xs:6,sm:3,md:2,lg:2,children:[(0,J.jsx)("b",{children:"Regeneration"}),": ",t.regeneration.toLocaleString()]}),(0,J.jsxs)(m.ZP,{item:!0,xs:6,children:[(0,J.jsx)(o.Z,{}),(0,J.jsx)(h.Z,{variant:"h6",children:"Resistances"})]}),(0,J.jsxs)(m.ZP,{item:!0,xs:6,sm:3,md:2,lg:2,children:[(0,J.jsx)("b",{children:"Physical"}),": ",qn(e.physicalResistance,1)]}),(0,J.jsxs)(m.ZP,{item:!0,xs:6,sm:3,md:2,lg:2,children:[(0,J.jsx)("b",{children:"Magical"}),": ",qn(e.magicalResistance,1)]}),(0,J.jsxs)(m.ZP,{item:!0,xs:6,sm:3,md:2,lg:2,children:[(0,J.jsx)("b",{children:"Fire"}),": ",qn(e.fireResistance,1)]}),(0,J.jsxs)(m.ZP,{item:!0,xs:6,sm:3,md:2,lg:2,children:[(0,J.jsx)("b",{children:"Ice"}),": ",qn(e.iceResistance,1)]}),(0,J.jsxs)(m.ZP,{item:!0,xs:6,sm:3,md:2,lg:2,children:[(0,J.jsx)("b",{children:"Lightning"}),": ",qn(e.lightningResistance,1)]}),(0,J.jsxs)(m.ZP,{item:!0,xs:6,sm:3,md:2,lg:2,children:[(0,J.jsx)("b",{children:"Holy"}),": ",qn(e.holyResistance,1)]}),(0,J.jsxs)(m.ZP,{item:!0,xs:6,sm:3,md:2,lg:2,children:[(0,J.jsx)("b",{children:"Blight"}),": ",qn(e.blightResistance,1)]}),(0,J.jsx)(m.ZP,{item:!0,xs:6,children:(0,J.jsx)(o.Z,{})}),(0,J.jsxs)(m.ZP,{item:!0,xs:6,sm:3,md:2,lg:2,children:[(0,J.jsx)("b",{children:"Enemy Strength"}),":"," ",qn(e.enemyStats.strength-1e6,1e6)]}),(0,J.jsxs)(m.ZP,{item:!0,xs:6,sm:3,md:2,lg:2,children:[(0,J.jsx)("b",{children:"Enemy Dexterity"}),":"," ",qn(e.enemyStats.dexterity-1e6,1e6)]}),(0,J.jsxs)(m.ZP,{item:!0,xs:6,sm:3,md:2,lg:2,children:[(0,J.jsx)("b",{children:"Enemy Constitution"}),":"," ",qn(e.enemyStats.constitution-1e6,1e6)]}),(0,J.jsxs)(m.ZP,{item:!0,xs:6,sm:3,md:2,lg:2,children:[(0,J.jsx)("b",{children:"Enemy Intelligence"}),":"," ",qn(e.enemyStats.intelligence-1e6,1e6)]}),(0,J.jsxs)(m.ZP,{item:!0,xs:6,sm:3,md:2,lg:2,children:[(0,J.jsx)("b",{children:"Enemy Wisdom"}),":"," ",qn(e.enemyStats.wisdom-1e6,1e6)]}),(0,J.jsxs)(m.ZP,{item:!0,xs:6,sm:3,md:2,lg:2,children:[(0,J.jsx)("b",{children:"Enemy Willpower"}),":"," ",qn(e.enemyStats.willpower-1e6,1e6)]}),(0,J.jsxs)(m.ZP,{item:!0,xs:6,sm:3,md:2,lg:2,children:[(0,J.jsx)("b",{children:"Enemy Luck"}),":"," ",qn(e.enemyStats.luck-1e6,1e6)]}),(0,J.jsxs)(m.ZP,{item:!0,xs:6,sm:3,md:2,lg:2,children:[(0,J.jsx)("b",{children:"Armor Reduction"}),":"," ",qn(e.armorReduction-1,1)]})]})})}function Bn({hero:e}){const[t]=(0,z.w3L)(),[n,a]=(0,i.useState)(e.settings.autoDust);return(0,J.jsx)(i.Fragment,{children:(0,J.jsxs)(m.ZP,{container:!0,columns:6,children:[(0,J.jsx)(m.ZP,{item:!0,xs:6,children:(0,J.jsx)(h.Z,{variant:"h5",children:"Autodust"})}),(0,J.jsx)(m.ZP,{item:!0,xs:6,children:(0,J.jsx)(h.Z,{variant:"subtitle2",children:"Automatically destroy enchanted items as they drop off monsters if they are at or below the following level."})}),(0,J.jsx)(m.ZP,{item:!0,xs:6,children:(0,J.jsx)(_.Z,{label:"Gear Level",value:n,onChange:e=>function(e){const t=Math.round(Number(e));!isNaN(t)&&Number.isFinite(t)&&a(t)}(e.target.value)})}),(0,J.jsx)(m.ZP,{item:!0,xs:6,children:(0,J.jsx)(Z.Z,{onClick:async function(){await t({variables:{value:n}})},children:"Save"})})]})})}const Dn={attackingAccuracy:"Attacking Accuracy",attackingDamage:"Attacking Damage",castingAccuracy:"Casting Accuracy",castingDamage:"Casting Damage",vitality:"Vitality",resilience:"Resilience",regeneration:"Regeneration"};function Tn({hero:e}){const[t,n]=(0,i.useState)(e.skillPercent),[a,{loading:s}]=(0,z.Xxd)(),[r,{loading:l}]=(0,z.hv7)();return(0,J.jsxs)("div",{children:[(0,J.jsx)(h.Z,{variant:"h4",children:"Skills"}),(0,J.jsx)(h.Z,{sx:{mb:1},children:"Select which skill you would like to improve, as well as percentage of how devoted your character is to leveling it up as opposed to receiving experience. This means that incoming experience is reduced by the percentage, however the amount of experience you gain doesn't affect the chances of gaining a skill level."}),(0,J.jsxs)(E.Z,{sx:{mb:5},children:[(0,J.jsx)(q.Z,{id:"active-skill-select-label",children:"Active Skill"}),(0,J.jsx)(K.Z,{labelId:"active-skill-select-label",id:"active-skill-select",value:e.activeSkill,label:"Active Skill",disabled:s,onChange:e=>a({variables:{skill:e.target.value}}),children:Object.values(z.lqA).map((e=>(0,J.jsx)(Q.Z,{value:e,children:Dn[e]},e)))})]}),(0,J.jsxs)(E.Z,{fullWidth:!0,children:[(0,J.jsx)(Zt.ZP,{value:t,step:1,getAriaValueText:e=>`${e}%`,onChange:(e,t)=>!Array.isArray(t)&&n(t),"aria-label":"Percent experience towards skills",valueLabelDisplay:"on",disabled:l}),(0,J.jsx)(Z.Z,{disabled:l,onClick:()=>r({variables:{percent:t}}),children:"Save Percent"})]})]})}function Gn({hero:e,stat:t}){const[n,a]=(0,i.useState)(e.settings.minimumStats[t]??10),[s]=(0,z.Rw_)();return(0,J.jsxs)(i.Fragment,{children:[(0,J.jsxs)(m.ZP,{item:!0,md:1,xs:2,children:[`${t.substr(0,1).toUpperCase()}${t.substr(1)}`,":"]}),(0,J.jsx)(m.ZP,{item:!0,xs:1,sm:2,children:(0,J.jsx)(_.Z,{fullWidth:!0,label:`Minimum ${t}`,value:n,onChange:e=>async function(e){let t=Number(e);!isNaN(t)&&Number.isFinite(t)&&(t=Math.max(1,Math.min(2e9,t)),a(t))}(e.target.value)})}),(0,J.jsx)(m.ZP,{item:!0,md:3,sm:2,xs:3,children:(0,J.jsxs)(Z.Z,{onClick:async function(){await s({variables:{name:t,value:n}})},children:["Set minimum ",t]})})]})}function Hn(){const e=R();return e?(0,J.jsxs)(l.Z,{children:[(0,J.jsx)(h.Z,{variant:"h2",children:"Settings"}),(0,J.jsx)(h.Z,{variant:"subtitle2",sx:{mb:1},children:"Configure your mysterious automation"}),(0,J.jsx)(Tn,{hero:e}),(0,J.jsx)(h.Z,{variant:"h5",children:"Minimum Stats"}),(0,J.jsx)(h.Z,{variant:"subtitle2",children:"Prevents transfering from lowering your stats below these values..."}),(0,J.jsxs)(m.ZP,{container:!0,columns:6,spacing:2,children:[(0,J.jsx)(Gn,{hero:e,stat:"strength"}),(0,J.jsx)(Gn,{hero:e,stat:"dexterity"}),(0,J.jsx)(Gn,{hero:e,stat:"constitution"}),(0,J.jsx)(Gn,{hero:e,stat:"intelligence"}),(0,J.jsx)(Gn,{hero:e,stat:"wisdom"}),(0,J.jsx)(Gn,{hero:e,stat:"willpower"}),(0,J.jsx)(Gn,{hero:e,stat:"luck"})]}),(0,J.jsx)(Bn,{hero:e})]}):(0,J.jsx)("div",{})}const zn=r()((()=>n.e(262).then(n.bind(n,7262))));function Rn(){const e=(0,a.useRouter)(),t=e.route.split("/").pop(),[n,s]=(0,$e.d)(),{data:r,loading:A,error:$}=(0,z.UEB)({fetchPolicy:"cache-only"}),[L,I]=(0,i.useState)(t??"play"),{data:F}=(0,z.Wg9)({pollInterval:3e4}),[M,E]=(0,i.useState)(!1),q=(0,i.useRef)(null);(0,i.useEffect)((()=>{"true"===window.localStorage.getItem("poc_has_moved_once")&&E(!0)}),[]);const W=(t,n)=>{"play"===n?e.push("/play","/play",{scroll:!1}):e.push(`/play/${n}`,`/play/${n}`,{scroll:!1}),I(n)},B=r?.me?.account?.hero??null,D=r?.me?.account?.access??null;if((0,i.useEffect)((()=>{!$&&n||e.push(`/?auth=${e.asPath}`)}),[$,n]),(0,i.useEffect)((()=>{if(!B?.location)return;const e=B.location,t=q.current;t?t.x===e.x&&t.y===e.y&&t.map===e.map||(q.current={x:e.x,y:e.y,map:e.map},M||(E(!0),window.localStorage.setItem("poc_has_moved_once","true"))):q.current={x:e.x,y:e.y,map:e.map}}),[B?.location?.x,B?.location?.y,B?.location?.map]),$||!n)return(0,J.jsx)(P.A,{children:(0,J.jsxs)(u.Z,{children:[(0,J.jsx)("br",{}),"Redirecting..."]})});if(A)return(0,J.jsx)(P.A,{children:(0,J.jsx)(u.Z,{children:A&&(0,J.jsx)(c.Z,{})})});const T=!!B?.inventory.find((e=>(0,N.r_)(e.baseItem))),G=B?.questLog?.washedUp,H=!!B&&B.levelCap>10,R=!!B&&B.level>=B.levelCap,K=!!B&&!H;return(0,J.jsx)(P.A,{showHero:!0,children:(0,J.jsxs)(u.Z,{children:[(0,J.jsxs)(i.Fragment,{children:[B&&B.attributePoints>0&&(0,J.jsx)(Wt,{}),B&&B.currentQuest&&(0,J.jsx)(Cn,{event:B.currentQuest})]}),(0,J.jsxs)(l.Z,{sx:{width:"100%",typography:"body1"},children:[(0,J.jsxs)(w.ZP,{value:L,children:[(0,J.jsxs)(l.Z,{sx:{borderBottom:1,borderColor:"divider"},children:[(0,J.jsx)(h.Z,{variant:"h1",sx:C.Z,children:"Navigation"}),(0,J.jsxs)(S.Z,{onChange:W,"aria-label":"navigation tabs",variant:"scrollable",children:[(0,J.jsx)(d.Z,{label:"Welcome",value:"play"}),(0,J.jsx)(d.Z,{label:"Combat",value:"combat","data-testid":"combat-nav"}),!(!B?.inventory.length&&!B?.gold)&&(0,J.jsx)(d.Z,{label:"Shop",value:"shop"}),!!B?.inventory.length&&(0,J.jsx)(d.Z,{label:"Inventory",value:"inventory","data-testid":"inventory-nav"}),(0,J.jsx)(d.Z,{label:"Map",value:"map"}),B&&Object.values(B.questLog).filter((e=>!!e)).length>2&&(0,J.jsx)(d.Z,{label:"Quests",value:"quests"}),T&&(0,J.jsx)(d.Z,{label:"Settings",value:"settings"}),D===z.Ksz.Admin&&(0,J.jsx)(d.Z,{label:"Admin",value:"admin"})]})]}),(0,J.jsx)(k.Z,{value:"play",children:(0,J.jsxs)(m.ZP,{container:!0,columns:12,spacing:4,children:[(0,J.jsxs)(m.ZP,{item:!0,xs:12,sm:7,md:8,children:[(0,J.jsxs)(h.Z,{variant:"h2",sx:{mb:2,fontSize:"1.8rem"},children:["Welcome to ",(0,J.jsx)("b",{children:"Proof of Combat"}),"!"]}),(0,J.jsxs)(h.Z,{variant:"subtitle1",sx:C.Z,children:["This text is only available to screen readers. Thank you for trying out my game! If you find any parts of the user interface that are difficult to navigate please let me know and I would love to improve them.",(0,J.jsx)("br",{}),(0,J.jsx)(x.Z,{href:"https://github.com/chrisinajar/proofofcombat/wiki/Screen-Readers-and-Accessibility",target:"_blank",rel:"noreferrer",children:"Check this wiki page for more details on accessibility"})]}),(0,J.jsx)(h.Z,{sx:{mb:2},children:"This is a text-based RPG where you can fight monsters, level up, and explore the world. The game is my passion project and is actively being developed at almost all times. Sometimes."}),(0,J.jsx)(h.Z,{variant:"h4",sx:C.Z,children:"Discord Server"}),(0,J.jsxs)(h.Z,{sx:{mb:2},children:["If you'd like to talk more with other players, report bugs, or discuss upcoming features,"," ",(0,J.jsx)(x.Z,{underline:"hover",href:"https://discord.gg/t7AZSxvfJG",target:"_blank",rel:"noreferrer",children:"join the discord!"})]}),(0,J.jsx)(h.Z,{variant:"h4",sx:C.Z,children:"Game Wiki"}),(0,J.jsxs)(h.Z,{sx:{mb:2},children:["A great deal of the game is undocumented, but the parts which are documented can be found"," ",(0,J.jsx)(x.Z,{underline:"hover",href:"https://github.com/chrisinajar/proofofcombat/wiki/",target:"_blank",rel:"noreferrer",children:"in the wiki"}),". The game is nearly impossible to 100% without consulting the wiki."]}),K&&(0,J.jsx)(g.Z,{variant:"outlined",sx:{mb:3},children:(0,J.jsxs)(j.Z,{children:[(0,J.jsx)(h.Z,{variant:"h6",sx:{mb:1},children:"Next steps"}),(0,J.jsxs)(p.Z,{dense:!0,children:[!R&&(0,J.jsxs)(b.ZP,{children:[(0,J.jsx)(y.Z,{children:(0,J.jsx)(v.Z,{fontSize:"small"})}),(0,J.jsx)(f.Z,{primary:"Open the Combat tab and challenge a nearby monster",primaryTypographyProps:{sx:{textDecoration:(B?.experience??0)>0?"line-through":"none"}}})]}),R&&!H&&(0,J.jsxs)(b.ZP,{secondaryAction:(0,J.jsx)(Z.Z,{size:"small",onClick:e=>W(0,"inventory"),"aria-label":"Open Inventory tab",variant:"text",children:"Open Inventory"}),children:[(0,J.jsx)(y.Z,{children:(0,J.jsx)(v.Z,{fontSize:"small"})}),(0,J.jsx)(f.Z,{primary:"Open the Inventory tab to complete your rebirth",secondary:"Select a rebirth totem in Quest items, then confirm",secondaryTypographyProps:{sx:{fontStyle:"italic"}}})]}),(0,J.jsxs)(b.ZP,{children:[(0,J.jsx)(y.Z,{children:(0,J.jsx)(v.Z,{fontSize:"small"})}),(0,J.jsx)(f.Z,{primary:"Visit the Map tab to move North/East/South/West",secondary:G?.started?void 0:"Maybe try going for a swim\u2026",primaryTypographyProps:{sx:{textDecoration:G?.started||M?"line-through":"none"}},secondaryTypographyProps:{sx:{fontStyle:"italic"}}})]}),(0,J.jsxs)(b.ZP,{children:[(0,J.jsx)(y.Z,{children:(0,J.jsx)(v.Z,{fontSize:"small"})}),(0,J.jsx)(f.Z,{primary:"Check the Shop tab after fights to buy or sell gear",primaryTypographyProps:{sx:{textDecoration:(B?.inventory.length??0)>0||(B?.gold??0)>0?"line-through":"none"}}})]})]})]})}),(0,J.jsx)(h.Z,{variant:"h5",sx:{mb:2},children:"Combat Stats"}),B?.combatStats&&(0,J.jsx)(Wn,{skills:B.skills,stats:B.combatStats})]}),F?.leaderboard&&(0,J.jsxs)(m.ZP,{item:!0,xs:12,sm:5,md:4,children:[(0,J.jsx)(h.Z,{variant:"h6",children:"Leaderboard"}),(0,J.jsx)("ul",{id:"leaderboard-list",children:F.leaderboard.slice(0,20).map(((e,t)=>(0,J.jsxs)("li",{id:`leaderboard-list-${t}`,children:[(0,J.jsx)("b",{id:`leaderboard-list-${t}-name`,children:e.name})," ","(",(0,N.qh)(e.class),")"]},e.id)))})]})]})}),(0,J.jsxs)(k.Z,{value:"combat",children:[(0,J.jsx)(h.Z,{variant:"h3",sx:{textAlign:"center"},children:"Combat"}),(0,J.jsx)(h.Z,{children:"Challenge a monster from the list, then fight it to the death. Note that other players in the same location see the same monster lists, so they may get to it first!"}),(0,J.jsx)("br",{}),(0,J.jsx)(Ae,{})]}),(0,J.jsx)(k.Z,{value:"shop",children:(0,J.jsx)(zt,{})}),(0,J.jsx)(k.Z,{value:"inventory",children:(0,J.jsx)(kn,{})}),(0,J.jsx)(k.Z,{value:"map",children:(0,J.jsx)(Et,{})}),(0,J.jsx)(k.Z,{value:"quests",children:(0,J.jsx)(En,{})}),(0,J.jsx)(k.Z,{value:"settings",children:(0,J.jsx)(Hn,{})}),(0,J.jsx)(k.Z,{value:"admin",children:(0,J.jsx)(zn,{})})]}),(0,J.jsx)(l.Z,{sx:{my:2},children:(0,J.jsx)(o.Z,{})}),(0,J.jsx)(re,{})]})]})})}}}]);